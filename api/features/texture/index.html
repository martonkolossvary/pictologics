
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="IBSI-compliant radiomic feature extraction library.">
      
      
        <meta name="author" content="Márton Kolossváry">
      
      
      
        <link rel="prev" href="../morphology/">
      
      
        <link rel="next" href="../../../benchmarks/">
      
      
        
      
      
      <link rel="icon" href="../../../favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Texture - Pictologics</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Share+Tech+Mono:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Share Tech Mono";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    


<link rel="icon" type="image/png" sizes="16x16" href="../../../assets/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../../assets/favicon-32x32.png">
<link rel="apple-touch-icon" sizes="180x180" href="../../../assets/logo.png">

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#texture-features-api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Pictologics" class="md-header__button md-logo" aria-label="Pictologics" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Pictologics
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Texture
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/martonkolossvary/pictologics" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    martonkolossvary/pictologics
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../user_guide/installation/" class="md-tabs__link">
          
  
  
  User Guide

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../loader/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../benchmarks/" class="md-tabs__link">
        
  
  
    
  
  Benchmarks

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../ibsi1_compliance/" class="md-tabs__link">
          
  
  
  IBSI Compliance

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../quality/" class="md-tabs__link">
        
  
  
    
  
  Quality Report

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../CHANGELOG/" class="md-tabs__link">
        
  
  
    
  
  Changelog

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../LICENSE/" class="md-tabs__link">
        
  
  
    
  
  License

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../NOTICE/" class="md-tabs__link">
        
  
  
    
  
  Notice

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Pictologics" class="md-nav__button md-logo" aria-label="Pictologics" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    Pictologics
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/martonkolossvary/pictologics" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    martonkolossvary/pictologics
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    User Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    User Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/data_loading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Loading
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/image_filtering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Image Filtering
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/feature_calculations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Feature Calculations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pipeline Usage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/predefined_configurations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Predefined Configurations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/utilities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utilities
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/case_examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Case Examples
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../loader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Loaders
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../preprocessing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Preprocessing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../filters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Filters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../results/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Results
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utilities
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" checked>
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../intensity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Intensity
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../morphology/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Morphology
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Texture
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Texture
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pictologics.features.texture" class="md-nav__link">
    <span class="md-ellipsis">
      
        texture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="texture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture--texture-feature-extraction-module" class="md-nav__link">
    <span class="md-ellipsis">
      
        Texture Feature Extraction Module
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Texture Feature Extraction Module">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture--key-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Concepts:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture--implemented-matrices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implemented Matrices:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture--optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimization:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture--usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Usage:
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture.calculate_all_texture_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_all_texture_features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture.calculate_all_texture_matrices" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_all_texture_matrices
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture.calculate_glcm_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_glcm_features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture.calculate_gldzm_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_gldzm_features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture.calculate_glrlm_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_glrlm_features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture.calculate_glszm_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_glszm_features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture.calculate_ngldm_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_ngldm_features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture.calculate_ngtdm_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_ngtdm_features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture.calculate_zone_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_zone_features
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../benchmarks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Benchmarks
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    IBSI Compliance
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    IBSI Compliance
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ibsi1_compliance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IBSI 1 (Features)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ibsi2_compliance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IBSI 2 Phase 1 (Filters)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ibsi2_phase2_compliance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IBSI 2 Phase 2 (Filtered Features)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ibsi2_phase3_compliance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IBSI 2 Phase 3 (Reproducibility)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../quality/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quality Report
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CHANGELOG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../LICENSE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    License
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../NOTICE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Notice
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pictologics.features.texture" class="md-nav__link">
    <span class="md-ellipsis">
      
        texture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="texture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture--texture-feature-extraction-module" class="md-nav__link">
    <span class="md-ellipsis">
      
        Texture Feature Extraction Module
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Texture Feature Extraction Module">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture--key-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Concepts:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture--implemented-matrices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implemented Matrices:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture--optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimization:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture--usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Usage:
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture.calculate_all_texture_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_all_texture_features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture.calculate_all_texture_matrices" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_all_texture_matrices
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture.calculate_glcm_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_glcm_features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture.calculate_gldzm_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_gldzm_features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture.calculate_glrlm_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_glrlm_features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture.calculate_glszm_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_glszm_features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture.calculate_ngldm_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_ngldm_features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture.calculate_ngtdm_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_ngtdm_features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pictologics.features.texture.calculate_zone_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        calculate_zone_features
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="texture-features-api">Texture Features API</h1>


<div class="doc doc-object doc-module">



<h2 id="pictologics.features.texture" class="doc doc-heading">
            <code>pictologics.features.texture</code>


</h2>

    <div class="doc doc-contents first">

        <h3 id="pictologics.features.texture--texture-feature-extraction-module">Texture Feature Extraction Module</h3>
<p>This module provides a comprehensive suite of functions for calculating 3D texture features
from medical images. It implements the Image Biomarker Standardisation Initiative (IBSI)
compliant algorithms for various texture matrices.</p>
<h4 id="pictologics.features.texture--key-concepts">Key Concepts:</h4>
<p>Texture analysis quantifies the spatial arrangement of grey levels in an image.
It assumes that the texture (e.g., "smooth", "coarse", "regular") is contained in the
spatial relationship between the grey levels of the voxels.</p>
<h4 id="pictologics.features.texture--implemented-matrices">Implemented Matrices:</h4>
<ol>
<li>
<p><strong>GLCM (Grey Level Co-occurrence Matrix)</strong>:
    Counts how often pairs of grey levels occur at a specific distance and direction.
    <em>Captures</em>: Contrast, homogeneity, correlation.</p>
</li>
<li>
<p><strong>GLRLM (Grey Level Run Length Matrix)</strong>:
    Counts the lengths of consecutive runs of the same grey level.
    <em>Captures</em>: Coarseness, directionality.</p>
</li>
<li>
<p><strong>GLSZM (Grey Level Size Zone Matrix)</strong>:
    Counts the size of zones (connected components) of the same grey level.
    <em>Captures</em>: Regional homogeneity, size distribution of texture elements.</p>
</li>
<li>
<p><strong>GLDZM (Grey Level Distance Zone Matrix)</strong>:
    Counts zones based on their distance from the ROI border.
    <em>Captures</em>: Spatial distribution relative to the boundary.</p>
</li>
<li>
<p><strong>NGTDM (Neighbourhood Grey Tone Difference Matrix)</strong>:
    Quantifies the difference between a voxel and its neighbours.
    <em>Captures</em>: Human perception of texture (coarseness, contrast, busyness).</p>
</li>
<li>
<p><strong>NGLDM (Neighbourhood Grey Level Dependence Matrix)</strong>:
    Captures the dependence of grey levels on their neighbours.
    <em>Captures</em>: Dependence, spatial relationships.</p>
</li>
</ol>
<h4 id="pictologics.features.texture--optimization">Optimization:</h4>
<p>This module uses <code>numba</code> for Just-In-Time (JIT) compilation to achieve high performance.
The core calculations are parallelized and optimized for memory usage.
- <strong>Single-pass calculation</strong>: Multiple matrices are computed in a single pass over the image
  to minimize memory access overhead.
- <strong>Flattened DFS</strong>: Zone-based features (GLSZM, GLDZM) use a memory-efficient Depth-First Search
  with flattened stack indices.</p>
<h4 id="pictologics.features.texture--usage">Usage:</h4>
<p>The main entry point is <code>calculate_all_texture_matrices</code>, which computes all raw matrices.
Then, specific feature calculation functions (e.g., <code>calculate_glcm_features</code>) can be called
using these matrices.</p>


<details class="example" open>
  <summary>Example</summary>
  <p>Calculate texture features:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pictologics.features.texture</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">calculate_all_texture_matrices</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">calculate_glcm_features</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="c1"># Create dummy data</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="c1"># Calculate matrices</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="n">matrices</span> <span class="o">=</span> <span class="n">calculate_all_texture_matrices</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="c1"># Extract features</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="n">glcm_feats</span> <span class="o">=</span> <span class="n">calculate_glcm_features</span><span class="p">(</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="n">data</span><span class="p">,</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    <span class="n">mask</span><span class="p">,</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="n">n_bins</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>    <span class="n">glcm_matrix</span><span class="o">=</span><span class="n">matrices</span><span class="p">[</span><span class="s1">&#39;glcm&#39;</span><span class="p">]</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="p">)</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="nb">print</span><span class="p">(</span><span class="n">glcm_feats</span><span class="p">[</span><span class="s1">&#39;contrast_ACUI&#39;</span><span class="p">])</span>
</code></pre></div>
</details>









<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pictologics.features.texture.calculate_all_texture_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_all_texture_features</span><span class="p">(</span><span class="n">disc_array</span><span class="p">,</span> <span class="n">mask_array</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">,</span> <span class="n">distance_mask_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ngldm_alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate all texture features (GLCM, GLRLM, GLSZM, GLDZM, NGTDM, NGLDM).</p>
<p>This is a convenience wrapper that computes all texture matrices and then
extracts all available features.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>disc_array</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Discretised image array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mask_array</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mask array (ROI).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_bins</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bins.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>distance_mask_array</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional mask for GLDZM distance calculation.
                 If None, mask_array is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ngldm_alpha</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The coarseness parameter α for NGLDM. Two grey levels are considered
dependent if their absolute difference is ≤ α. Default is 0 (IBSI standard).</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of all texture features.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pictologics/features/texture.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1919">1919</a></span>
<span class="normal"><a href="#__codelineno-0-1920">1920</a></span>
<span class="normal"><a href="#__codelineno-0-1921">1921</a></span>
<span class="normal"><a href="#__codelineno-0-1922">1922</a></span>
<span class="normal"><a href="#__codelineno-0-1923">1923</a></span>
<span class="normal"><a href="#__codelineno-0-1924">1924</a></span>
<span class="normal"><a href="#__codelineno-0-1925">1925</a></span>
<span class="normal"><a href="#__codelineno-0-1926">1926</a></span>
<span class="normal"><a href="#__codelineno-0-1927">1927</a></span>
<span class="normal"><a href="#__codelineno-0-1928">1928</a></span>
<span class="normal"><a href="#__codelineno-0-1929">1929</a></span>
<span class="normal"><a href="#__codelineno-0-1930">1930</a></span>
<span class="normal"><a href="#__codelineno-0-1931">1931</a></span>
<span class="normal"><a href="#__codelineno-0-1932">1932</a></span>
<span class="normal"><a href="#__codelineno-0-1933">1933</a></span>
<span class="normal"><a href="#__codelineno-0-1934">1934</a></span>
<span class="normal"><a href="#__codelineno-0-1935">1935</a></span>
<span class="normal"><a href="#__codelineno-0-1936">1936</a></span>
<span class="normal"><a href="#__codelineno-0-1937">1937</a></span>
<span class="normal"><a href="#__codelineno-0-1938">1938</a></span>
<span class="normal"><a href="#__codelineno-0-1939">1939</a></span>
<span class="normal"><a href="#__codelineno-0-1940">1940</a></span>
<span class="normal"><a href="#__codelineno-0-1941">1941</a></span>
<span class="normal"><a href="#__codelineno-0-1942">1942</a></span>
<span class="normal"><a href="#__codelineno-0-1943">1943</a></span>
<span class="normal"><a href="#__codelineno-0-1944">1944</a></span>
<span class="normal"><a href="#__codelineno-0-1945">1945</a></span>
<span class="normal"><a href="#__codelineno-0-1946">1946</a></span>
<span class="normal"><a href="#__codelineno-0-1947">1947</a></span>
<span class="normal"><a href="#__codelineno-0-1948">1948</a></span>
<span class="normal"><a href="#__codelineno-0-1949">1949</a></span>
<span class="normal"><a href="#__codelineno-0-1950">1950</a></span>
<span class="normal"><a href="#__codelineno-0-1951">1951</a></span>
<span class="normal"><a href="#__codelineno-0-1952">1952</a></span>
<span class="normal"><a href="#__codelineno-0-1953">1953</a></span>
<span class="normal"><a href="#__codelineno-0-1954">1954</a></span>
<span class="normal"><a href="#__codelineno-0-1955">1955</a></span>
<span class="normal"><a href="#__codelineno-0-1956">1956</a></span>
<span class="normal"><a href="#__codelineno-0-1957">1957</a></span>
<span class="normal"><a href="#__codelineno-0-1958">1958</a></span>
<span class="normal"><a href="#__codelineno-0-1959">1959</a></span>
<span class="normal"><a href="#__codelineno-0-1960">1960</a></span>
<span class="normal"><a href="#__codelineno-0-1961">1961</a></span>
<span class="normal"><a href="#__codelineno-0-1962">1962</a></span>
<span class="normal"><a href="#__codelineno-0-1963">1963</a></span>
<span class="normal"><a href="#__codelineno-0-1964">1964</a></span>
<span class="normal"><a href="#__codelineno-0-1965">1965</a></span>
<span class="normal"><a href="#__codelineno-0-1966">1966</a></span>
<span class="normal"><a href="#__codelineno-0-1967">1967</a></span>
<span class="normal"><a href="#__codelineno-0-1968">1968</a></span>
<span class="normal"><a href="#__codelineno-0-1969">1969</a></span>
<span class="normal"><a href="#__codelineno-0-1970">1970</a></span>
<span class="normal"><a href="#__codelineno-0-1971">1971</a></span>
<span class="normal"><a href="#__codelineno-0-1972">1972</a></span>
<span class="normal"><a href="#__codelineno-0-1973">1973</a></span>
<span class="normal"><a href="#__codelineno-0-1974">1974</a></span>
<span class="normal"><a href="#__codelineno-0-1975">1975</a></span>
<span class="normal"><a href="#__codelineno-0-1976">1976</a></span>
<span class="normal"><a href="#__codelineno-0-1977">1977</a></span>
<span class="normal"><a href="#__codelineno-0-1978">1978</a></span>
<span class="normal"><a href="#__codelineno-0-1979">1979</a></span>
<span class="normal"><a href="#__codelineno-0-1980">1980</a></span>
<span class="normal"><a href="#__codelineno-0-1981">1981</a></span>
<span class="normal"><a href="#__codelineno-0-1982">1982</a></span>
<span class="normal"><a href="#__codelineno-0-1983">1983</a></span>
<span class="normal"><a href="#__codelineno-0-1984">1984</a></span>
<span class="normal"><a href="#__codelineno-0-1985">1985</a></span>
<span class="normal"><a href="#__codelineno-0-1986">1986</a></span>
<span class="normal"><a href="#__codelineno-0-1987">1987</a></span>
<span class="normal"><a href="#__codelineno-0-1988">1988</a></span>
<span class="normal"><a href="#__codelineno-0-1989">1989</a></span>
<span class="normal"><a href="#__codelineno-0-1990">1990</a></span>
<span class="normal"><a href="#__codelineno-0-1991">1991</a></span>
<span class="normal"><a href="#__codelineno-0-1992">1992</a></span>
<span class="normal"><a href="#__codelineno-0-1993">1993</a></span>
<span class="normal"><a href="#__codelineno-0-1994">1994</a></span>
<span class="normal"><a href="#__codelineno-0-1995">1995</a></span>
<span class="normal"><a href="#__codelineno-0-1996">1996</a></span>
<span class="normal"><a href="#__codelineno-0-1997">1997</a></span>
<span class="normal"><a href="#__codelineno-0-1998">1998</a></span>
<span class="normal"><a href="#__codelineno-0-1999">1999</a></span>
<span class="normal"><a href="#__codelineno-0-2000">2000</a></span>
<span class="normal"><a href="#__codelineno-0-2001">2001</a></span>
<span class="normal"><a href="#__codelineno-0-2002">2002</a></span>
<span class="normal"><a href="#__codelineno-0-2003">2003</a></span>
<span class="normal"><a href="#__codelineno-0-2004">2004</a></span>
<span class="normal"><a href="#__codelineno-0-2005">2005</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1919" name="__codelineno-0-1919"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_all_texture_features</span><span class="p">(</span>
<a id="__codelineno-0-1920" name="__codelineno-0-1920"></a>    <span class="n">disc_array</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
<a id="__codelineno-0-1921" name="__codelineno-0-1921"></a>    <span class="n">mask_array</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
<a id="__codelineno-0-1922" name="__codelineno-0-1922"></a>    <span class="n">n_bins</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-1923" name="__codelineno-0-1923"></a>    <span class="n">distance_mask_array</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1924" name="__codelineno-0-1924"></a>    <span class="n">ngldm_alpha</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-1925" name="__codelineno-0-1925"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-1926" name="__codelineno-0-1926"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1927" name="__codelineno-0-1927"></a><span class="sd">    Calculate all texture features (GLCM, GLRLM, GLSZM, GLDZM, NGTDM, NGLDM).</span>
<a id="__codelineno-0-1928" name="__codelineno-0-1928"></a>
<a id="__codelineno-0-1929" name="__codelineno-0-1929"></a><span class="sd">    This is a convenience wrapper that computes all texture matrices and then</span>
<a id="__codelineno-0-1930" name="__codelineno-0-1930"></a><span class="sd">    extracts all available features.</span>
<a id="__codelineno-0-1931" name="__codelineno-0-1931"></a>
<a id="__codelineno-0-1932" name="__codelineno-0-1932"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1933" name="__codelineno-0-1933"></a><span class="sd">        disc_array: Discretised image array.</span>
<a id="__codelineno-0-1934" name="__codelineno-0-1934"></a><span class="sd">        mask_array: Mask array (ROI).</span>
<a id="__codelineno-0-1935" name="__codelineno-0-1935"></a><span class="sd">        n_bins: Number of bins.</span>
<a id="__codelineno-0-1936" name="__codelineno-0-1936"></a><span class="sd">        distance_mask_array: Optional mask for GLDZM distance calculation.</span>
<a id="__codelineno-0-1937" name="__codelineno-0-1937"></a><span class="sd">                             If None, mask_array is used.</span>
<a id="__codelineno-0-1938" name="__codelineno-0-1938"></a><span class="sd">        ngldm_alpha: The coarseness parameter α for NGLDM. Two grey levels are considered</span>
<a id="__codelineno-0-1939" name="__codelineno-0-1939"></a><span class="sd">            dependent if their absolute difference is ≤ α. Default is 0 (IBSI standard).</span>
<a id="__codelineno-0-1940" name="__codelineno-0-1940"></a>
<a id="__codelineno-0-1941" name="__codelineno-0-1941"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1942" name="__codelineno-0-1942"></a><span class="sd">        Dictionary of all texture features.</span>
<a id="__codelineno-0-1943" name="__codelineno-0-1943"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1944" name="__codelineno-0-1944"></a>    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1945" name="__codelineno-0-1945"></a>
<a id="__codelineno-0-1946" name="__codelineno-0-1946"></a>    <span class="c1"># Calculate all matrices once</span>
<a id="__codelineno-0-1947" name="__codelineno-0-1947"></a>    <span class="n">texture_matrices</span> <span class="o">=</span> <span class="n">calculate_all_texture_matrices</span><span class="p">(</span>
<a id="__codelineno-0-1948" name="__codelineno-0-1948"></a>        <span class="n">disc_array</span><span class="p">,</span>
<a id="__codelineno-0-1949" name="__codelineno-0-1949"></a>        <span class="n">mask_array</span><span class="p">,</span>
<a id="__codelineno-0-1950" name="__codelineno-0-1950"></a>        <span class="n">n_bins</span><span class="p">,</span>
<a id="__codelineno-0-1951" name="__codelineno-0-1951"></a>        <span class="n">distance_mask</span><span class="o">=</span><span class="n">distance_mask_array</span><span class="p">,</span>
<a id="__codelineno-0-1952" name="__codelineno-0-1952"></a>        <span class="n">ngldm_alpha</span><span class="o">=</span><span class="n">ngldm_alpha</span><span class="p">,</span>
<a id="__codelineno-0-1953" name="__codelineno-0-1953"></a>    <span class="p">)</span>
<a id="__codelineno-0-1954" name="__codelineno-0-1954"></a>
<a id="__codelineno-0-1955" name="__codelineno-0-1955"></a>    <span class="c1"># GLCM</span>
<a id="__codelineno-0-1956" name="__codelineno-0-1956"></a>    <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
<a id="__codelineno-0-1957" name="__codelineno-0-1957"></a>        <span class="n">calculate_glcm_features</span><span class="p">(</span>
<a id="__codelineno-0-1958" name="__codelineno-0-1958"></a>            <span class="n">disc_array</span><span class="p">,</span> <span class="n">mask_array</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">,</span> <span class="n">glcm_matrix</span><span class="o">=</span><span class="n">texture_matrices</span><span class="p">[</span><span class="s2">&quot;glcm&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1959" name="__codelineno-0-1959"></a>        <span class="p">)</span>
<a id="__codelineno-0-1960" name="__codelineno-0-1960"></a>    <span class="p">)</span>
<a id="__codelineno-0-1961" name="__codelineno-0-1961"></a>
<a id="__codelineno-0-1962" name="__codelineno-0-1962"></a>    <span class="c1"># GLRLM</span>
<a id="__codelineno-0-1963" name="__codelineno-0-1963"></a>    <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
<a id="__codelineno-0-1964" name="__codelineno-0-1964"></a>        <span class="n">calculate_glrlm_features</span><span class="p">(</span>
<a id="__codelineno-0-1965" name="__codelineno-0-1965"></a>            <span class="n">disc_array</span><span class="p">,</span> <span class="n">mask_array</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">,</span> <span class="n">glrlm_matrix</span><span class="o">=</span><span class="n">texture_matrices</span><span class="p">[</span><span class="s2">&quot;glrlm&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1966" name="__codelineno-0-1966"></a>        <span class="p">)</span>
<a id="__codelineno-0-1967" name="__codelineno-0-1967"></a>    <span class="p">)</span>
<a id="__codelineno-0-1968" name="__codelineno-0-1968"></a>
<a id="__codelineno-0-1969" name="__codelineno-0-1969"></a>    <span class="c1"># GLSZM</span>
<a id="__codelineno-0-1970" name="__codelineno-0-1970"></a>    <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
<a id="__codelineno-0-1971" name="__codelineno-0-1971"></a>        <span class="n">calculate_glszm_features</span><span class="p">(</span>
<a id="__codelineno-0-1972" name="__codelineno-0-1972"></a>            <span class="n">disc_array</span><span class="p">,</span> <span class="n">mask_array</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">,</span> <span class="n">glszm_matrix</span><span class="o">=</span><span class="n">texture_matrices</span><span class="p">[</span><span class="s2">&quot;glszm&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1973" name="__codelineno-0-1973"></a>        <span class="p">)</span>
<a id="__codelineno-0-1974" name="__codelineno-0-1974"></a>    <span class="p">)</span>
<a id="__codelineno-0-1975" name="__codelineno-0-1975"></a>
<a id="__codelineno-0-1976" name="__codelineno-0-1976"></a>    <span class="c1"># GLDZM</span>
<a id="__codelineno-0-1977" name="__codelineno-0-1977"></a>    <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
<a id="__codelineno-0-1978" name="__codelineno-0-1978"></a>        <span class="n">calculate_gldzm_features</span><span class="p">(</span>
<a id="__codelineno-0-1979" name="__codelineno-0-1979"></a>            <span class="n">disc_array</span><span class="p">,</span>
<a id="__codelineno-0-1980" name="__codelineno-0-1980"></a>            <span class="n">mask_array</span><span class="p">,</span>
<a id="__codelineno-0-1981" name="__codelineno-0-1981"></a>            <span class="n">n_bins</span><span class="p">,</span>
<a id="__codelineno-0-1982" name="__codelineno-0-1982"></a>            <span class="n">gldzm_matrix</span><span class="o">=</span><span class="n">texture_matrices</span><span class="p">[</span><span class="s2">&quot;gldzm&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1983" name="__codelineno-0-1983"></a>            <span class="n">distance_mask</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-1984" name="__codelineno-0-1984"></a>                <span class="n">distance_mask_array</span> <span class="k">if</span> <span class="n">distance_mask_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mask_array</span>
<a id="__codelineno-0-1985" name="__codelineno-0-1985"></a>            <span class="p">),</span>
<a id="__codelineno-0-1986" name="__codelineno-0-1986"></a>        <span class="p">)</span>
<a id="__codelineno-0-1987" name="__codelineno-0-1987"></a>    <span class="p">)</span>
<a id="__codelineno-0-1988" name="__codelineno-0-1988"></a>
<a id="__codelineno-0-1989" name="__codelineno-0-1989"></a>    <span class="c1"># NGTDM</span>
<a id="__codelineno-0-1990" name="__codelineno-0-1990"></a>    <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
<a id="__codelineno-0-1991" name="__codelineno-0-1991"></a>        <span class="n">calculate_ngtdm_features</span><span class="p">(</span>
<a id="__codelineno-0-1992" name="__codelineno-0-1992"></a>            <span class="n">disc_array</span><span class="p">,</span>
<a id="__codelineno-0-1993" name="__codelineno-0-1993"></a>            <span class="n">mask_array</span><span class="p">,</span>
<a id="__codelineno-0-1994" name="__codelineno-0-1994"></a>            <span class="n">n_bins</span><span class="p">,</span>
<a id="__codelineno-0-1995" name="__codelineno-0-1995"></a>            <span class="n">ngtdm_matrices</span><span class="o">=</span><span class="p">(</span><span class="n">texture_matrices</span><span class="p">[</span><span class="s2">&quot;ngtdm_s&quot;</span><span class="p">],</span> <span class="n">texture_matrices</span><span class="p">[</span><span class="s2">&quot;ngtdm_n&quot;</span><span class="p">]),</span>
<a id="__codelineno-0-1996" name="__codelineno-0-1996"></a>        <span class="p">)</span>
<a id="__codelineno-0-1997" name="__codelineno-0-1997"></a>    <span class="p">)</span>
<a id="__codelineno-0-1998" name="__codelineno-0-1998"></a>    <span class="c1"># NGLDM</span>
<a id="__codelineno-0-1999" name="__codelineno-0-1999"></a>    <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
<a id="__codelineno-0-2000" name="__codelineno-0-2000"></a>        <span class="n">calculate_ngldm_features</span><span class="p">(</span>
<a id="__codelineno-0-2001" name="__codelineno-0-2001"></a>            <span class="n">disc_array</span><span class="p">,</span> <span class="n">mask_array</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">,</span> <span class="n">ngldm_matrix</span><span class="o">=</span><span class="n">texture_matrices</span><span class="p">[</span><span class="s2">&quot;ngldm&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2002" name="__codelineno-0-2002"></a>        <span class="p">)</span>
<a id="__codelineno-0-2003" name="__codelineno-0-2003"></a>    <span class="p">)</span>
<a id="__codelineno-0-2004" name="__codelineno-0-2004"></a>
<a id="__codelineno-0-2005" name="__codelineno-0-2005"></a>    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pictologics.features.texture.calculate_all_texture_matrices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_all_texture_matrices</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">,</span> <span class="n">distance_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ngldm_alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate all texture matrices (GLCM, GLRLM, GLSZM, GLDZM, NGTDM, NGLDM) in an optimized single pass.</p>
<p>This function serves as the computational backbone for texture analysis. It computes the raw
matrices required to extract specific texture features. By aggregating these calculations,
it minimizes the number of passes over the image data, significantly improving performance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The 3D image array containing discretised grey levels.
Values should be integers in the range [1, n_bins].</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mask</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The 3D binary mask array defining the Region of Interest (ROI).
Must have the same shape as <code>data</code>. Non-zero values indicate the ROI.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_bins</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of grey levels used for discretization (e.g., 16, 32, 64).
This determines the size of the resulting matrices.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>distance_mask</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional mask used to calculate the distance map for GLDZM.
If None, <code>mask</code> is used. This allows calculating distances based on the morphological mask
while analyzing intensities from the intensity mask (e.g., after outlier filtering).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ngldm_alpha</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The coarseness parameter α for NGLDM calculation. Two grey levels are
considered dependent if their absolute difference is ≤ α. Default is 0 (exact match),
which is the IBSI standard. Use α=1 for tolerance of ±1 grey level difference.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, Any]: A dictionary containing the calculated texture matrices:
- 'glcm' (npt.NDArray[np.floating[Any]]): Grey Level Co-occurrence Matrix. Shape: (n_dirs, n_bins, n_bins).
- 'glrlm' (npt.NDArray[np.floating[Any]]): Grey Level Run Length Matrix. Shape: (n_dirs, n_bins, max_run_length).
- 'ngtdm_s' (npt.NDArray[np.floating[Any]]): NGTDM Sum of absolute differences. Shape: (n_bins,).
- 'ngtdm_n' (npt.NDArray[np.floating[Any]]): NGTDM Number of valid voxels. Shape: (n_bins,).
- 'ngldm' (npt.NDArray[np.floating[Any]]): Neighbouring Grey Level Dependence Matrix. Shape: (n_bins, n_dependence).
- 'glszm' (npt.NDArray[np.floating[Any]]): Grey Level Size Zone Matrix. Shape: (n_bins, max_zone_size).
- 'gldzm' (npt.NDArray[np.floating[Any]]): Grey Level Distance Zone Matrix. Shape: (n_bins, max_distance).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>Calculate all texture matrices:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pictologics.features.texture</span><span class="w"> </span><span class="kn">import</span> <span class="n">calculate_all_texture_matrices</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1"># Create dummy data</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="c1"># Calculate matrices</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="n">matrices</span> <span class="o">=</span> <span class="n">calculate_all_texture_matrices</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="nb">print</span><span class="p">(</span><span class="n">matrices</span><span class="p">[</span><span class="s1">&#39;glcm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="c1"># (13, 32, 32)</span>
</code></pre></div>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>pictologics/features/texture.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_all_texture_matrices</span><span class="p">(</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>    <span class="n">data</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>    <span class="n">mask</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>    <span class="n">n_bins</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>    <span class="n">distance_mask</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>    <span class="n">ngldm_alpha</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a><span class="sd">    Calculate all texture matrices (GLCM, GLRLM, GLSZM, GLDZM, NGTDM, NGLDM) in an optimized single pass.</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a><span class="sd">    This function serves as the computational backbone for texture analysis. It computes the raw</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a><span class="sd">    matrices required to extract specific texture features. By aggregating these calculations,</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a><span class="sd">    it minimizes the number of passes over the image data, significantly improving performance.</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a><span class="sd">        data (npt.NDArray[np.floating[Any]]): The 3D image array containing discretised grey levels.</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a><span class="sd">            Values should be integers in the range [1, n_bins].</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a><span class="sd">        mask (npt.NDArray[np.floating[Any]]): The 3D binary mask array defining the Region of Interest (ROI).</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a><span class="sd">            Must have the same shape as `data`. Non-zero values indicate the ROI.</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a><span class="sd">        n_bins (int): The number of grey levels used for discretization (e.g., 16, 32, 64).</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a><span class="sd">            This determines the size of the resulting matrices.</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="sd">        distance_mask (Optional[npt.NDArray[np.floating[Any]]]): Optional mask used to calculate the distance map for GLDZM.</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a><span class="sd">            If None, `mask` is used. This allows calculating distances based on the morphological mask</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a><span class="sd">            while analyzing intensities from the intensity mask (e.g., after outlier filtering).</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a><span class="sd">        ngldm_alpha (int): The coarseness parameter α for NGLDM calculation. Two grey levels are</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">            considered dependent if their absolute difference is ≤ α. Default is 0 (exact match),</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a><span class="sd">            which is the IBSI standard. Use α=1 for tolerance of ±1 grey level difference.</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">        dict[str, Any]: A dictionary containing the calculated texture matrices:</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="sd">            - &#39;glcm&#39; (npt.NDArray[np.floating[Any]]): Grey Level Co-occurrence Matrix. Shape: (n_dirs, n_bins, n_bins).</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="sd">            - &#39;glrlm&#39; (npt.NDArray[np.floating[Any]]): Grey Level Run Length Matrix. Shape: (n_dirs, n_bins, max_run_length).</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a><span class="sd">            - &#39;ngtdm_s&#39; (npt.NDArray[np.floating[Any]]): NGTDM Sum of absolute differences. Shape: (n_bins,).</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a><span class="sd">            - &#39;ngtdm_n&#39; (npt.NDArray[np.floating[Any]]): NGTDM Number of valid voxels. Shape: (n_bins,).</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a><span class="sd">            - &#39;ngldm&#39; (npt.NDArray[np.floating[Any]]): Neighbouring Grey Level Dependence Matrix. Shape: (n_bins, n_dependence).</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a><span class="sd">            - &#39;glszm&#39; (npt.NDArray[np.floating[Any]]): Grey Level Size Zone Matrix. Shape: (n_bins, max_zone_size).</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a><span class="sd">            - &#39;gldzm&#39; (npt.NDArray[np.floating[Any]]): Grey Level Distance Zone Matrix. Shape: (n_bins, max_distance).</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a><span class="sd">        Calculate all texture matrices:</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a><span class="sd">        ```python</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a><span class="sd">        import numpy as np</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="sd">        from pictologics.features.texture import calculate_all_texture_matrices</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">        # Create dummy data</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">        data = np.random.randint(1, 33, (50, 50, 50))</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="sd">        mask = np.ones((50, 50, 50))</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">        # Calculate matrices</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a><span class="sd">        matrices = calculate_all_texture_matrices(data, mask, n_bins=32)</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">        print(matrices[&#39;glcm&#39;].shape)</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">        # (13, 32, 32)</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a><span class="sd">        ```</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>    <span class="c1"># Fast exit for empty ROI</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)):</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>            <span class="s2">&quot;glcm&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">13</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">),</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>            <span class="s2">&quot;glrlm&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">13</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">),</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>            <span class="s2">&quot;ngtdm_s&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_bins</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>            <span class="s2">&quot;ngtdm_n&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_bins</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>            <span class="s2">&quot;ngldm&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_bins</span><span class="p">,</span> <span class="mi">27</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">),</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>            <span class="s2">&quot;glszm&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_bins</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">),</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>            <span class="s2">&quot;gldzm&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_bins</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">),</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>        <span class="p">}</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>    <span class="c1"># Crop to ROI bounding box (union with distance_mask when provided) to reduce memory traffic.</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>    <span class="n">data_c</span><span class="p">,</span> <span class="n">mask_c</span><span class="p">,</span> <span class="n">distmask_c</span> <span class="o">=</span> <span class="n">_maybe_crop_to_bbox</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">distance_mask</span><span class="p">)</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>    <span class="c1"># Use a compact mask representation for kernels.</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>    <span class="k">if</span> <span class="n">mask_c</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>        <span class="n">mask_u8</span> <span class="o">=</span> <span class="n">mask_c</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>        <span class="n">mask_u8</span> <span class="o">=</span> <span class="p">(</span><span class="n">mask_c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>    <span class="c1"># 1. Local Features (GLCM, GLRLM, NGTDM, NGLDM)</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>    <span class="c1"># Pre-cast data to smallest possible int type (0-based)</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>    <span class="c1"># Input data is 1-based, so we subtract 1.</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>    <span class="k">if</span> <span class="n">n_bins</span> <span class="o">&lt;=</span> <span class="mi">256</span><span class="p">:</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>        <span class="n">data_int</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>        <span class="n">data_int</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>        <span class="n">n_threads</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">numba</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">NUMBA_NUM_THREADS</span><span class="p">)</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>        <span class="n">n_threads</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Fallback</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>    <span class="n">glcm</span><span class="p">,</span> <span class="n">glrlm</span><span class="p">,</span> <span class="n">ngtdm_s</span><span class="p">,</span> <span class="n">ngtdm_n</span><span class="p">,</span> <span class="n">ngldm</span> <span class="o">=</span> <span class="n">_calculate_local_features_numba</span><span class="p">(</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>        <span class="n">data_int</span><span class="p">,</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>        <span class="n">mask_u8</span><span class="p">,</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>        <span class="n">n_bins</span><span class="p">,</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>        <span class="n">calc_glcm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>        <span class="n">calc_glrlm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>        <span class="n">calc_ngtdm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>        <span class="n">calc_ngldm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>        <span class="n">offsets_26</span><span class="o">=</span><span class="n">OFFSETS_26</span><span class="p">,</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>        <span class="n">directions_13</span><span class="o">=</span><span class="n">DIRECTIONS_13</span><span class="p">,</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>        <span class="n">ngldm_alpha</span><span class="o">=</span><span class="n">ngldm_alpha</span><span class="p">,</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>        <span class="n">n_threads</span><span class="o">=</span><span class="n">n_threads</span><span class="p">,</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>    <span class="p">)</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>    <span class="c1"># 2. Zone Features (GLSZM, GLDZM)</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>    <span class="c1"># Pre-calculate distance map for GLDZM</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>    <span class="c1"># Use distance_mask if provided, else mask</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>    <span class="n">d_mask</span> <span class="o">=</span> <span class="n">distmask_c</span> <span class="k">if</span> <span class="n">distmask_c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mask_u8</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>    <span class="c1"># Pad the mask with 0s to ensure the image border is treated as an edge.</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>    <span class="n">mask_bool</span> <span class="o">=</span> <span class="n">d_mask</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>    <span class="n">mask_padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">mask_bool</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>    <span class="n">dist_map_padded</span> <span class="o">=</span> <span class="n">distance_transform_cdt</span><span class="p">(</span><span class="n">mask_padded</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;taxicab&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>        <span class="n">np</span><span class="o">.</span><span class="n">int32</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>    <span class="p">)</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>    <span class="n">dist_map</span> <span class="o">=</span> <span class="n">dist_map_padded</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>    <span class="n">glszm</span><span class="p">,</span> <span class="n">gldzm</span> <span class="o">=</span> <span class="n">calculate_zone_features</span><span class="p">(</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>        <span class="n">data_c</span><span class="p">,</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>        <span class="n">mask_u8</span><span class="p">,</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>        <span class="n">dist_map</span><span class="p">,</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>        <span class="n">n_bins</span><span class="p">,</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>        <span class="n">calc_glszm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>        <span class="n">calc_gldzm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>    <span class="p">)</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>        <span class="s2">&quot;glcm&quot;</span><span class="p">:</span> <span class="n">glcm</span><span class="p">,</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>        <span class="s2">&quot;glrlm&quot;</span><span class="p">:</span> <span class="n">glrlm</span><span class="p">,</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>        <span class="s2">&quot;ngtdm_s&quot;</span><span class="p">:</span> <span class="n">ngtdm_s</span><span class="p">,</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>        <span class="s2">&quot;ngtdm_n&quot;</span><span class="p">:</span> <span class="n">ngtdm_n</span><span class="p">,</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>        <span class="s2">&quot;ngldm&quot;</span><span class="p">:</span> <span class="n">ngldm</span><span class="p">,</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>        <span class="s2">&quot;glszm&quot;</span><span class="p">:</span> <span class="n">glszm</span><span class="p">,</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>        <span class="s2">&quot;gldzm&quot;</span><span class="p">:</span> <span class="n">gldzm</span><span class="p">,</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pictologics.features.texture.calculate_glcm_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_glcm_features</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">,</span> <span class="n">glcm_matrix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <div class="highlight"><pre><span></span><code>Calculate Grey Level Co-occurrence Matrix (GLCM) features.

The GLCM describes the second-order statistical distribution of grey levels in the ROI.
It counts how often pairs of grey levels occur at a specific distance and direction.
This implementation computes features based on the 3D merged GLCM (averaged over all 13 directions),
making the features rotationally invariant.

**IBSI Reference**: Section 3.6 (Grey Level Co-occurrence Based Features).

**Mathematical Definition**:
Let $P(i,j)$ be the co-occurrence matrix, where $i$ and $j$ are grey levels.
The matrix is normalized such that $\sum_{i,j} P(i,j) = 1$.

**Calculated Features**:
*   Joint Maximum (GYBY)
*   Joint Average (60VM)
*   Joint Variance (UR99)
*   Joint Entropy (TU9B)
*   Difference Average (TF7R)
*   Difference Variance (D3YU)
*   Difference Entropy (NTRS)
*   Sum Average (ZGXS)
*   Sum Variance (OEEB)
*   Sum Entropy (P6QZ)
*   Angular Second Moment (8ZQL)
*   Contrast (ACUI)
*   Dissimilarity (8S9J)
*   Inverse Difference (IB1Z)
*   Normalised Inverse Difference (NDRX)
*   Inverse Difference Moment (WF0Z)
*   Normalised Inverse Difference Moment (1QCO)
*   Inverse Variance (E8JP)
*   Correlation (NI2N)
*   Autocorrelation (QWB0)
*   Cluster Tendency (DG8W)
*   Cluster Shade (7NFM)
*   Cluster Prominence (AE86)
*   Information Correlation 1 (R8DG)
*   Information Correlation 2 (JN9H)

Args:
    data (npt.NDArray[np.floating[Any]]): The 3D image array containing discretised grey levels.
    mask (npt.NDArray[np.floating[Any]]): The 3D binary mask array defining the ROI.
    n_bins (int): The number of grey levels.
    glcm_matrix (Optional[npt.NDArray[np.floating[Any]]]): Pre-calculated GLCM matrix. If provided, `data` and `mask`
        are ignored for matrix calculation, but `data` is still used for `Ng` estimation if needed.
        If None, the matrix is calculated from scratch.

Returns:
    dict[str, float]: A dictionary of calculated GLCM features, keyed by their name and IBSI code.
        Example keys: &#39;joint_maximum_GYBY&#39;, &#39;contrast_ACUI&#39;, &#39;correlation_NI2N&#39;.

Example:
    ```python
    import numpy as np
</code></pre></div>
<p>from numpy import typing as npt
        # ... assuming data and mask defined ...
        features = calculate_glcm_features(data, mask, n_bins=32)
        print(features['contrast_ACUI'])
        ```
        12.5</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pictologics/features/texture.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-775"> 775</a></span>
<span class="normal"><a href="#__codelineno-0-776"> 776</a></span>
<span class="normal"><a href="#__codelineno-0-777"> 777</a></span>
<span class="normal"><a href="#__codelineno-0-778"> 778</a></span>
<span class="normal"><a href="#__codelineno-0-779"> 779</a></span>
<span class="normal"><a href="#__codelineno-0-780"> 780</a></span>
<span class="normal"><a href="#__codelineno-0-781"> 781</a></span>
<span class="normal"><a href="#__codelineno-0-782"> 782</a></span>
<span class="normal"><a href="#__codelineno-0-783"> 783</a></span>
<span class="normal"><a href="#__codelineno-0-784"> 784</a></span>
<span class="normal"><a href="#__codelineno-0-785"> 785</a></span>
<span class="normal"><a href="#__codelineno-0-786"> 786</a></span>
<span class="normal"><a href="#__codelineno-0-787"> 787</a></span>
<span class="normal"><a href="#__codelineno-0-788"> 788</a></span>
<span class="normal"><a href="#__codelineno-0-789"> 789</a></span>
<span class="normal"><a href="#__codelineno-0-790"> 790</a></span>
<span class="normal"><a href="#__codelineno-0-791"> 791</a></span>
<span class="normal"><a href="#__codelineno-0-792"> 792</a></span>
<span class="normal"><a href="#__codelineno-0-793"> 793</a></span>
<span class="normal"><a href="#__codelineno-0-794"> 794</a></span>
<span class="normal"><a href="#__codelineno-0-795"> 795</a></span>
<span class="normal"><a href="#__codelineno-0-796"> 796</a></span>
<span class="normal"><a href="#__codelineno-0-797"> 797</a></span>
<span class="normal"><a href="#__codelineno-0-798"> 798</a></span>
<span class="normal"><a href="#__codelineno-0-799"> 799</a></span>
<span class="normal"><a href="#__codelineno-0-800"> 800</a></span>
<span class="normal"><a href="#__codelineno-0-801"> 801</a></span>
<span class="normal"><a href="#__codelineno-0-802"> 802</a></span>
<span class="normal"><a href="#__codelineno-0-803"> 803</a></span>
<span class="normal"><a href="#__codelineno-0-804"> 804</a></span>
<span class="normal"><a href="#__codelineno-0-805"> 805</a></span>
<span class="normal"><a href="#__codelineno-0-806"> 806</a></span>
<span class="normal"><a href="#__codelineno-0-807"> 807</a></span>
<span class="normal"><a href="#__codelineno-0-808"> 808</a></span>
<span class="normal"><a href="#__codelineno-0-809"> 809</a></span>
<span class="normal"><a href="#__codelineno-0-810"> 810</a></span>
<span class="normal"><a href="#__codelineno-0-811"> 811</a></span>
<span class="normal"><a href="#__codelineno-0-812"> 812</a></span>
<span class="normal"><a href="#__codelineno-0-813"> 813</a></span>
<span class="normal"><a href="#__codelineno-0-814"> 814</a></span>
<span class="normal"><a href="#__codelineno-0-815"> 815</a></span>
<span class="normal"><a href="#__codelineno-0-816"> 816</a></span>
<span class="normal"><a href="#__codelineno-0-817"> 817</a></span>
<span class="normal"><a href="#__codelineno-0-818"> 818</a></span>
<span class="normal"><a href="#__codelineno-0-819"> 819</a></span>
<span class="normal"><a href="#__codelineno-0-820"> 820</a></span>
<span class="normal"><a href="#__codelineno-0-821"> 821</a></span>
<span class="normal"><a href="#__codelineno-0-822"> 822</a></span>
<span class="normal"><a href="#__codelineno-0-823"> 823</a></span>
<span class="normal"><a href="#__codelineno-0-824"> 824</a></span>
<span class="normal"><a href="#__codelineno-0-825"> 825</a></span>
<span class="normal"><a href="#__codelineno-0-826"> 826</a></span>
<span class="normal"><a href="#__codelineno-0-827"> 827</a></span>
<span class="normal"><a href="#__codelineno-0-828"> 828</a></span>
<span class="normal"><a href="#__codelineno-0-829"> 829</a></span>
<span class="normal"><a href="#__codelineno-0-830"> 830</a></span>
<span class="normal"><a href="#__codelineno-0-831"> 831</a></span>
<span class="normal"><a href="#__codelineno-0-832"> 832</a></span>
<span class="normal"><a href="#__codelineno-0-833"> 833</a></span>
<span class="normal"><a href="#__codelineno-0-834"> 834</a></span>
<span class="normal"><a href="#__codelineno-0-835"> 835</a></span>
<span class="normal"><a href="#__codelineno-0-836"> 836</a></span>
<span class="normal"><a href="#__codelineno-0-837"> 837</a></span>
<span class="normal"><a href="#__codelineno-0-838"> 838</a></span>
<span class="normal"><a href="#__codelineno-0-839"> 839</a></span>
<span class="normal"><a href="#__codelineno-0-840"> 840</a></span>
<span class="normal"><a href="#__codelineno-0-841"> 841</a></span>
<span class="normal"><a href="#__codelineno-0-842"> 842</a></span>
<span class="normal"><a href="#__codelineno-0-843"> 843</a></span>
<span class="normal"><a href="#__codelineno-0-844"> 844</a></span>
<span class="normal"><a href="#__codelineno-0-845"> 845</a></span>
<span class="normal"><a href="#__codelineno-0-846"> 846</a></span>
<span class="normal"><a href="#__codelineno-0-847"> 847</a></span>
<span class="normal"><a href="#__codelineno-0-848"> 848</a></span>
<span class="normal"><a href="#__codelineno-0-849"> 849</a></span>
<span class="normal"><a href="#__codelineno-0-850"> 850</a></span>
<span class="normal"><a href="#__codelineno-0-851"> 851</a></span>
<span class="normal"><a href="#__codelineno-0-852"> 852</a></span>
<span class="normal"><a href="#__codelineno-0-853"> 853</a></span>
<span class="normal"><a href="#__codelineno-0-854"> 854</a></span>
<span class="normal"><a href="#__codelineno-0-855"> 855</a></span>
<span class="normal"><a href="#__codelineno-0-856"> 856</a></span>
<span class="normal"><a href="#__codelineno-0-857"> 857</a></span>
<span class="normal"><a href="#__codelineno-0-858"> 858</a></span>
<span class="normal"><a href="#__codelineno-0-859"> 859</a></span>
<span class="normal"><a href="#__codelineno-0-860"> 860</a></span>
<span class="normal"><a href="#__codelineno-0-861"> 861</a></span>
<span class="normal"><a href="#__codelineno-0-862"> 862</a></span>
<span class="normal"><a href="#__codelineno-0-863"> 863</a></span>
<span class="normal"><a href="#__codelineno-0-864"> 864</a></span>
<span class="normal"><a href="#__codelineno-0-865"> 865</a></span>
<span class="normal"><a href="#__codelineno-0-866"> 866</a></span>
<span class="normal"><a href="#__codelineno-0-867"> 867</a></span>
<span class="normal"><a href="#__codelineno-0-868"> 868</a></span>
<span class="normal"><a href="#__codelineno-0-869"> 869</a></span>
<span class="normal"><a href="#__codelineno-0-870"> 870</a></span>
<span class="normal"><a href="#__codelineno-0-871"> 871</a></span>
<span class="normal"><a href="#__codelineno-0-872"> 872</a></span>
<span class="normal"><a href="#__codelineno-0-873"> 873</a></span>
<span class="normal"><a href="#__codelineno-0-874"> 874</a></span>
<span class="normal"><a href="#__codelineno-0-875"> 875</a></span>
<span class="normal"><a href="#__codelineno-0-876"> 876</a></span>
<span class="normal"><a href="#__codelineno-0-877"> 877</a></span>
<span class="normal"><a href="#__codelineno-0-878"> 878</a></span>
<span class="normal"><a href="#__codelineno-0-879"> 879</a></span>
<span class="normal"><a href="#__codelineno-0-880"> 880</a></span>
<span class="normal"><a href="#__codelineno-0-881"> 881</a></span>
<span class="normal"><a href="#__codelineno-0-882"> 882</a></span>
<span class="normal"><a href="#__codelineno-0-883"> 883</a></span>
<span class="normal"><a href="#__codelineno-0-884"> 884</a></span>
<span class="normal"><a href="#__codelineno-0-885"> 885</a></span>
<span class="normal"><a href="#__codelineno-0-886"> 886</a></span>
<span class="normal"><a href="#__codelineno-0-887"> 887</a></span>
<span class="normal"><a href="#__codelineno-0-888"> 888</a></span>
<span class="normal"><a href="#__codelineno-0-889"> 889</a></span>
<span class="normal"><a href="#__codelineno-0-890"> 890</a></span>
<span class="normal"><a href="#__codelineno-0-891"> 891</a></span>
<span class="normal"><a href="#__codelineno-0-892"> 892</a></span>
<span class="normal"><a href="#__codelineno-0-893"> 893</a></span>
<span class="normal"><a href="#__codelineno-0-894"> 894</a></span>
<span class="normal"><a href="#__codelineno-0-895"> 895</a></span>
<span class="normal"><a href="#__codelineno-0-896"> 896</a></span>
<span class="normal"><a href="#__codelineno-0-897"> 897</a></span>
<span class="normal"><a href="#__codelineno-0-898"> 898</a></span>
<span class="normal"><a href="#__codelineno-0-899"> 899</a></span>
<span class="normal"><a href="#__codelineno-0-900"> 900</a></span>
<span class="normal"><a href="#__codelineno-0-901"> 901</a></span>
<span class="normal"><a href="#__codelineno-0-902"> 902</a></span>
<span class="normal"><a href="#__codelineno-0-903"> 903</a></span>
<span class="normal"><a href="#__codelineno-0-904"> 904</a></span>
<span class="normal"><a href="#__codelineno-0-905"> 905</a></span>
<span class="normal"><a href="#__codelineno-0-906"> 906</a></span>
<span class="normal"><a href="#__codelineno-0-907"> 907</a></span>
<span class="normal"><a href="#__codelineno-0-908"> 908</a></span>
<span class="normal"><a href="#__codelineno-0-909"> 909</a></span>
<span class="normal"><a href="#__codelineno-0-910"> 910</a></span>
<span class="normal"><a href="#__codelineno-0-911"> 911</a></span>
<span class="normal"><a href="#__codelineno-0-912"> 912</a></span>
<span class="normal"><a href="#__codelineno-0-913"> 913</a></span>
<span class="normal"><a href="#__codelineno-0-914"> 914</a></span>
<span class="normal"><a href="#__codelineno-0-915"> 915</a></span>
<span class="normal"><a href="#__codelineno-0-916"> 916</a></span>
<span class="normal"><a href="#__codelineno-0-917"> 917</a></span>
<span class="normal"><a href="#__codelineno-0-918"> 918</a></span>
<span class="normal"><a href="#__codelineno-0-919"> 919</a></span>
<span class="normal"><a href="#__codelineno-0-920"> 920</a></span>
<span class="normal"><a href="#__codelineno-0-921"> 921</a></span>
<span class="normal"><a href="#__codelineno-0-922"> 922</a></span>
<span class="normal"><a href="#__codelineno-0-923"> 923</a></span>
<span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-775" name="__codelineno-0-775"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_glcm_features</span><span class="p">(</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>    <span class="n">data</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>    <span class="n">mask</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>    <span class="n">n_bins</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>    <span class="n">glcm_matrix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a><span class="sd">        Calculate Grey Level Co-occurrence Matrix (GLCM) features.</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a><span class="sd">        The GLCM describes the second-order statistical distribution of grey levels in the ROI.</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a><span class="sd">        It counts how often pairs of grey levels occur at a specific distance and direction.</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a><span class="sd">        This implementation computes features based on the 3D merged GLCM (averaged over all 13 directions),</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a><span class="sd">        making the features rotationally invariant.</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="sd">        **IBSI Reference**: Section 3.6 (Grey Level Co-occurrence Based Features).</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a><span class="sd">        **Mathematical Definition**:</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a><span class="sd">        Let $P(i,j)$ be the co-occurrence matrix, where $i$ and $j$ are grey levels.</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a><span class="sd">        The matrix is normalized such that $\sum_{i,j} P(i,j) = 1$.</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a><span class="sd">        **Calculated Features**:</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a><span class="sd">        *   Joint Maximum (GYBY)</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a><span class="sd">        *   Joint Average (60VM)</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a><span class="sd">        *   Joint Variance (UR99)</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a><span class="sd">        *   Joint Entropy (TU9B)</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a><span class="sd">        *   Difference Average (TF7R)</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a><span class="sd">        *   Difference Variance (D3YU)</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a><span class="sd">        *   Difference Entropy (NTRS)</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a><span class="sd">        *   Sum Average (ZGXS)</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a><span class="sd">        *   Sum Variance (OEEB)</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a><span class="sd">        *   Sum Entropy (P6QZ)</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a><span class="sd">        *   Angular Second Moment (8ZQL)</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a><span class="sd">        *   Contrast (ACUI)</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a><span class="sd">        *   Dissimilarity (8S9J)</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="sd">        *   Inverse Difference (IB1Z)</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a><span class="sd">        *   Normalised Inverse Difference (NDRX)</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a><span class="sd">        *   Inverse Difference Moment (WF0Z)</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a><span class="sd">        *   Normalised Inverse Difference Moment (1QCO)</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a><span class="sd">        *   Inverse Variance (E8JP)</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a><span class="sd">        *   Correlation (NI2N)</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a><span class="sd">        *   Autocorrelation (QWB0)</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a><span class="sd">        *   Cluster Tendency (DG8W)</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a><span class="sd">        *   Cluster Shade (7NFM)</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a><span class="sd">        *   Cluster Prominence (AE86)</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a><span class="sd">        *   Information Correlation 1 (R8DG)</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a><span class="sd">        *   Information Correlation 2 (JN9H)</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a><span class="sd">            data (npt.NDArray[np.floating[Any]]): The 3D image array containing discretised grey levels.</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a><span class="sd">            mask (npt.NDArray[np.floating[Any]]): The 3D binary mask array defining the ROI.</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a><span class="sd">            n_bins (int): The number of grey levels.</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a><span class="sd">            glcm_matrix (Optional[npt.NDArray[np.floating[Any]]]): Pre-calculated GLCM matrix. If provided, `data` and `mask`</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a><span class="sd">                are ignored for matrix calculation, but `data` is still used for `Ng` estimation if needed.</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a><span class="sd">                If None, the matrix is calculated from scratch.</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a><span class="sd">            dict[str, float]: A dictionary of calculated GLCM features, keyed by their name and IBSI code.</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a><span class="sd">                Example keys: &#39;joint_maximum_GYBY&#39;, &#39;contrast_ACUI&#39;, &#39;correlation_NI2N&#39;.</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a><span class="sd">        Example:</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a><span class="sd">            ```python</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a><span class="sd">            import numpy as np</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a><span class="sd">    from numpy import typing as npt</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a><span class="sd">            # ... assuming data and mask defined ...</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a><span class="sd">            features = calculate_glcm_features(data, mask, n_bins=32)</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a><span class="sd">            print(features[&#39;contrast_ACUI&#39;])</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a><span class="sd">            ```</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a><span class="sd">            12.5</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>    <span class="k">if</span> <span class="n">glcm_matrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>        <span class="n">data_c</span><span class="p">,</span> <span class="n">mask_c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_maybe_crop_to_bbox</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>        <span class="k">if</span> <span class="n">mask_c</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>            <span class="n">mask_u8</span> <span class="o">=</span> <span class="n">mask_c</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>            <span class="n">mask_u8</span> <span class="o">=</span> <span class="p">(</span><span class="n">mask_c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>        <span class="k">if</span> <span class="n">n_bins</span> <span class="o">&lt;=</span> <span class="mi">256</span><span class="p">:</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>            <span class="n">data_int</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>            <span class="n">data_int</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>        <span class="c1"># Determine n_threads for JIT call</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>            <span class="n">n_threads</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">numba</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">NUMBA_NUM_THREADS</span><span class="p">)</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>            <span class="n">n_threads</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Fallback</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>        <span class="c1"># Call combined kernel to calculate only GLCM</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>        <span class="n">glcm</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_calculate_local_features_numba</span><span class="p">(</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>            <span class="n">data_int</span><span class="p">,</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>            <span class="n">mask_u8</span><span class="p">,</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>            <span class="n">n_bins</span><span class="p">,</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>            <span class="n">calc_glcm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>            <span class="n">calc_glrlm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>            <span class="n">calc_ngtdm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>            <span class="n">calc_ngldm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>            <span class="n">offsets_26</span><span class="o">=</span><span class="n">OFFSETS_26</span><span class="p">,</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>            <span class="n">directions_13</span><span class="o">=</span><span class="n">DIRECTIONS_13</span><span class="p">,</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>            <span class="n">ngldm_alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>            <span class="n">n_threads</span><span class="o">=</span><span class="n">n_threads</span><span class="p">,</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>        <span class="p">)</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>        <span class="n">glcm</span> <span class="o">=</span> <span class="n">glcm_matrix</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>    <span class="c1"># Merge (Sum) -&gt; IAZD</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>    <span class="n">glcm_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">glcm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>    <span class="n">glcm_sym</span> <span class="o">=</span> <span class="n">glcm_sum</span> <span class="o">+</span> <span class="n">glcm_sum</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>    <span class="c1"># Normalize</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>    <span class="n">total_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">glcm_sym</span><span class="p">)</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>    <span class="k">if</span> <span class="n">total_sum</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>        <span class="k">return</span> <span class="p">{}</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>    <span class="n">P</span> <span class="o">=</span> <span class="n">glcm_sym</span> <span class="o">/</span> <span class="n">total_sum</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>    <span class="c1"># Indices (0-based from np.indices, convert to 1-based for IBSI)</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>    <span class="n">i_idx</span><span class="p">,</span> <span class="n">j_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">((</span><span class="n">n_bins</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">))</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>    <span class="n">I</span> <span class="o">=</span> <span class="n">i_idx</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># noqa: E741</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>    <span class="n">J</span> <span class="o">=</span> <span class="n">j_idx</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>    <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>    <span class="c1"># Joint Maximum - GYBY</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;joint_maximum_GYBY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>    <span class="c1"># Joint Average - 60VM</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;joint_average_60VM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">I</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>    <span class="c1"># Joint Variance - UR99</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>    <span class="n">mu</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="s2">&quot;joint_average_60VM&quot;</span><span class="p">]</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;joint_variance_UR99&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">I</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>    <span class="c1"># Joint Entropy - TU9B</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>    <span class="n">mask_p</span> <span class="o">=</span> <span class="n">P</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;joint_entropy_TU9B&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">mask_p</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">mask_p</span><span class="p">]))</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>    <span class="c1"># Difference Average - TF7R</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>    <span class="n">k_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">I</span> <span class="o">-</span> <span class="n">J</span><span class="p">)</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;difference_average_TF7R&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">k_diff</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>    <span class="c1"># Optimized using bincount</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>    <span class="n">k_diff_flat</span> <span class="o">=</span> <span class="n">k_diff</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>    <span class="n">P_flat</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>    <span class="n">p_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">k_diff_flat</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">P_flat</span><span class="p">)</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>    <span class="n">mu_diff</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="s2">&quot;difference_average_TF7R&quot;</span><span class="p">]</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>    <span class="n">k_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_bins</span><span class="p">)</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;difference_variance_D3YU&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">k_vals</span> <span class="o">-</span> <span class="n">mu_diff</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">p_diff</span><span class="p">)</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>    <span class="c1"># Difference Entropy - NTRS</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>    <span class="n">mask_pd</span> <span class="o">=</span> <span class="n">p_diff</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;difference_entropy_NTRS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>        <span class="n">p_diff</span><span class="p">[</span><span class="n">mask_pd</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">p_diff</span><span class="p">[</span><span class="n">mask_pd</span><span class="p">])</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>    <span class="p">)</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>    <span class="c1"># Sum Average - ZGXS</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>    <span class="n">k_sum_grid</span> <span class="o">=</span> <span class="n">I</span> <span class="o">+</span> <span class="n">J</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>    <span class="c1"># Optimized using bincount</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>    <span class="n">k_sum_flat</span> <span class="o">=</span> <span class="n">k_sum_grid</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>    <span class="c1"># P_flat is already defined in Difference Variance block</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>    <span class="n">p_sum_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">k_sum_flat</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">P_flat</span><span class="p">)</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>    <span class="c1"># Slice from 2.</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>    <span class="n">p_sum</span> <span class="o">=</span> <span class="n">p_sum_full</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>    <span class="n">k_vals_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n_bins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;sum_average_ZGXS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">k_vals_sum</span> <span class="o">*</span> <span class="n">p_sum</span><span class="p">)</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>    <span class="c1"># Sum Variance - OEEB</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>    <span class="n">mu_sum</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="s2">&quot;sum_average_ZGXS&quot;</span><span class="p">]</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;sum_variance_OEEB&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">k_vals_sum</span> <span class="o">-</span> <span class="n">mu_sum</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">p_sum</span><span class="p">)</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>    <span class="c1"># Sum Entropy - P6QZ</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>    <span class="n">mask_ps</span> <span class="o">=</span> <span class="n">p_sum</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;sum_entropy_P6QZ&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p_sum</span><span class="p">[</span><span class="n">mask_ps</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">p_sum</span><span class="p">[</span><span class="n">mask_ps</span><span class="p">]))</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>    <span class="c1"># Angular Second Moment (Energy) - 8ZQL</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;angular_second_moment_8ZQL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>    <span class="c1"># Contrast - ACUI</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;contrast_ACUI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">I</span> <span class="o">-</span> <span class="n">J</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>    <span class="c1"># Dissimilarity - 8S9J</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;dissimilarity_8S9J&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">I</span> <span class="o">-</span> <span class="n">J</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>    <span class="c1"># Inverse Difference - IB1Z</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;inverse_difference_IB1Z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">I</span> <span class="o">-</span> <span class="n">J</span><span class="p">)))</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>    <span class="n">roi_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">mask</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">roi_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>        <span class="n">Ng_eff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">roi_data</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">roi_data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>        <span class="n">Ng_eff</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Fallback</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>    <span class="c1"># Normalised Inverse Difference - NDRX</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;normalised_inverse_difference_NDRX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>        <span class="n">P</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">I</span> <span class="o">-</span> <span class="n">J</span><span class="p">)</span> <span class="o">/</span> <span class="n">Ng_eff</span><span class="p">)</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>    <span class="p">)</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>    <span class="c1"># Inverse Difference Moment - WF0Z</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;inverse_difference_moment_WF0Z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">I</span> <span class="o">-</span> <span class="n">J</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>    <span class="c1"># Normalised Inverse Difference Moment - 1QCO</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;normalised_inverse_difference_moment_1QCO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>        <span class="n">P</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">((</span><span class="n">I</span> <span class="o">-</span> <span class="n">J</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Ng_eff</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>    <span class="p">)</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>    <span class="c1"># Inverse Variance - E8JP</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>    <span class="n">mask_neq</span> <span class="o">=</span> <span class="n">I</span> <span class="o">!=</span> <span class="n">J</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;inverse_variance_E8JP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>        <span class="n">P</span><span class="p">[</span><span class="n">mask_neq</span><span class="p">]</span> <span class="o">/</span> <span class="p">((</span><span class="n">I</span><span class="p">[</span><span class="n">mask_neq</span><span class="p">]</span> <span class="o">-</span> <span class="n">J</span><span class="p">[</span><span class="n">mask_neq</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>    <span class="p">)</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>    <span class="c1"># Correlation - NI2N</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>    <span class="n">term1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">I</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>    <span class="k">if</span> <span class="n">features</span><span class="p">[</span><span class="s2">&quot;joint_variance_UR99&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>        <span class="n">features</span><span class="p">[</span><span class="s2">&quot;correlation_NI2N&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">term1</span> <span class="o">/</span> <span class="n">features</span><span class="p">[</span><span class="s2">&quot;joint_variance_UR99&quot;</span><span class="p">]</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>        <span class="n">features</span><span class="p">[</span><span class="s2">&quot;correlation_NI2N&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>            <span class="mf">1.0</span>  <span class="c1"># Or NaN? IBSI doesn&#39;t specify for 0 variance.</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>        <span class="p">)</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>    <span class="c1"># Autocorrelation - QWB0</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;autocorrelation_QWB0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">I</span> <span class="o">*</span> <span class="n">J</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>    <span class="c1"># Cluster Tendency - DG8W</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;cluster_tendency_DG8W&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">I</span> <span class="o">+</span> <span class="n">J</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mu</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>    <span class="c1"># Cluster Shade - 7NFM</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;cluster_shade_7NFM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">I</span> <span class="o">+</span> <span class="n">J</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mu</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>    <span class="c1"># Cluster Prominence - AE86</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;cluster_prominence_AE86&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">I</span> <span class="o">+</span> <span class="n">J</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mu</span><span class="p">)</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>    <span class="c1"># Information Correlation 1 - R8DG</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>    <span class="n">HXY</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="s2">&quot;joint_entropy_TU9B&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>    <span class="n">p_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>    <span class="n">mask_px</span> <span class="o">=</span> <span class="n">p_x</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>    <span class="n">HX</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p_x</span><span class="p">[</span><span class="n">mask_px</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">p_x</span><span class="p">[</span><span class="n">mask_px</span><span class="p">]))</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>    <span class="n">HXY1</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">mask_p</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">p_x</span><span class="p">[</span><span class="n">I</span><span class="p">[</span><span class="n">mask_p</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_x</span><span class="p">[</span><span class="n">J</span><span class="p">[</span><span class="n">mask_p</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>    <span class="k">if</span> <span class="n">HX</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>        <span class="n">features</span><span class="p">[</span><span class="s2">&quot;information_correlation_1_R8DG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">HXY</span> <span class="o">-</span> <span class="n">HXY1</span><span class="p">)</span> <span class="o">/</span> <span class="n">HX</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>        <span class="n">features</span><span class="p">[</span><span class="s2">&quot;information_correlation_1_R8DG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>    <span class="c1"># Information Correlation 2 - JN9H</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>    <span class="n">P_prod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p_x</span><span class="p">,</span> <span class="n">p_x</span><span class="p">)</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>    <span class="n">mask_prod</span> <span class="o">=</span> <span class="n">P_prod</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>    <span class="n">HXY2</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P_prod</span><span class="p">[</span><span class="n">mask_prod</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">P_prod</span><span class="p">[</span><span class="n">mask_prod</span><span class="p">]))</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;information_correlation_2_JN9H&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">HXY2</span> <span class="o">-</span> <span class="n">HXY</span><span class="p">)))</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>    <span class="k">return</span> <span class="n">features</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pictologics.features.texture.calculate_gldzm_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_gldzm_features</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">,</span> <span class="n">gldzm_matrix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distance_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate Grey Level Distance Zone Matrix (GLDZM) features.</p>
<p>The GLDZM counts the number of zones of linked voxels with the same grey level,
categorized by the distance of the zone from the ROI border.
This captures information about the spatial distribution of textures relative to the boundary.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The 3D image array containing discretised grey levels.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mask</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The 3D binary mask array defining the ROI.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_bins</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of grey levels.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gldzm_matrix</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-calculated GLDZM matrix.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>distance_mask</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional mask used to calculate the distance map.
If None, <code>mask</code> is used. This allows calculating distances based on the morphological mask
while analyzing intensities from the intensity mask (e.g., after outlier filtering).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, float]: A dictionary of calculated GLDZM features.
Example keys: 'small_distance_emphasis_0GBI', 'zone_distance_entropy_GBDU'.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pictologics/features/texture.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1504" name="__codelineno-0-1504"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_gldzm_features</span><span class="p">(</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>    <span class="n">data</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>    <span class="n">mask</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a>    <span class="n">n_bins</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a>    <span class="n">gldzm_matrix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a>    <span class="n">distance_mask</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a><span class="sd">    Calculate Grey Level Distance Zone Matrix (GLDZM) features.</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a><span class="sd">    The GLDZM counts the number of zones of linked voxels with the same grey level,</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a><span class="sd">    categorized by the distance of the zone from the ROI border.</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a><span class="sd">    This captures information about the spatial distribution of textures relative to the boundary.</span>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>
<a id="__codelineno-0-1518" name="__codelineno-0-1518"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1519" name="__codelineno-0-1519"></a><span class="sd">        data (npt.NDArray[np.floating[Any]]): The 3D image array containing discretised grey levels.</span>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a><span class="sd">        mask (npt.NDArray[np.floating[Any]]): The 3D binary mask array defining the ROI.</span>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a><span class="sd">        n_bins (int): The number of grey levels.</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a><span class="sd">        gldzm_matrix (Optional[npt.NDArray[np.floating[Any]]]): Pre-calculated GLDZM matrix.</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a><span class="sd">        distance_mask (Optional[npt.NDArray[np.floating[Any]]]): Optional mask used to calculate the distance map.</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a><span class="sd">            If None, `mask` is used. This allows calculating distances based on the morphological mask</span>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a><span class="sd">            while analyzing intensities from the intensity mask (e.g., after outlier filtering).</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a><span class="sd">        dict[str, float]: A dictionary of calculated GLDZM features.</span>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a><span class="sd">            Example keys: &#39;small_distance_emphasis_0GBI&#39;, &#39;zone_distance_entropy_GBDU&#39;.</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a>    <span class="k">if</span> <span class="n">gldzm_matrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a>        <span class="c1"># Calculate distance map</span>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>        <span class="c1"># Use distance_mask if provided, else mask</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a>        <span class="n">d_mask</span> <span class="o">=</span> <span class="n">distance_mask</span> <span class="k">if</span> <span class="n">distance_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mask</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>        <span class="c1"># Pad the mask with 0s to ensure the image border is treated as an edge.</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>        <span class="n">mask_bool</span> <span class="o">=</span> <span class="n">d_mask</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>        <span class="n">mask_padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">mask_bool</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>        <span class="n">dist_map_padded</span> <span class="o">=</span> <span class="n">distance_transform_cdt</span><span class="p">(</span><span class="n">mask_padded</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;taxicab&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>            <span class="n">np</span><span class="o">.</span><span class="n">int32</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>        <span class="p">)</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>        <span class="n">dist_map</span> <span class="o">=</span> <span class="n">dist_map_padded</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>        <span class="n">_</span><span class="p">,</span> <span class="n">gldzm</span> <span class="o">=</span> <span class="n">calculate_zone_features</span><span class="p">(</span>  <span class="c1"># type: ignore[arg-type]</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>            <span class="n">data</span><span class="p">,</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>            <span class="n">mask</span><span class="p">,</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>            <span class="n">dist_map</span><span class="p">,</span>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>            <span class="n">n_bins</span><span class="p">,</span>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>            <span class="n">calc_glszm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>            <span class="n">calc_gldzm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>        <span class="p">)</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>        <span class="n">gldzm</span> <span class="o">=</span> <span class="n">gldzm_matrix</span>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a>    <span class="n">N_zones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gldzm</span><span class="p">)</span>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a>    <span class="k">if</span> <span class="n">N_zones</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a>        <span class="k">return</span> <span class="p">{}</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>    <span class="n">P</span> <span class="o">=</span> <span class="n">gldzm</span> <span class="o">/</span> <span class="n">N_zones</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>    <span class="n">n_g</span><span class="p">,</span> <span class="n">n_d</span> <span class="o">=</span> <span class="n">gldzm</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>    <span class="n">i_idx</span><span class="p">,</span> <span class="n">j_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">((</span><span class="n">n_g</span><span class="p">,</span> <span class="n">n_d</span><span class="p">))</span>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>    <span class="n">I</span> <span class="o">=</span> <span class="n">i_idx</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># noqa: E741</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>    <span class="n">J</span> <span class="o">=</span> <span class="n">j_idx</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Distance</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>    <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>    <span class="c1"># Small Distance Emphasis (SDE) - 0GBI</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;small_distance_emphasis_0GBI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">/</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>    <span class="c1"># Large Distance Emphasis (LDE) - MB4I</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;large_distance_emphasis_MB4I&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>    <span class="c1"># Grey Level Non-Uniformity (GLNU) - VFT7</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>    <span class="n">s_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gldzm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;grey_level_non_uniformity_VFT7&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_i</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">N_zones</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>    <span class="c1"># Normalised Grey Level Non-Uniformity (GLNN) - 7HP3</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;normalised_grey_level_non_uniformity_7HP3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_i</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>        <span class="n">N_zones</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>    <span class="p">)</span>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>    <span class="c1"># Zone Distance Non-Uniformity (ZDNU) - V294</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>    <span class="n">s_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gldzm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;zone_distance_non_uniformity_V294&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_j</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">N_zones</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>    <span class="c1"># Normalised Zone Distance Non-Uniformity (ZDNN) - IATH</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;normalised_zone_distance_non_uniformity_IATH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_j</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>        <span class="n">N_zones</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>    <span class="p">)</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>    <span class="c1"># Zone Percentage (ZP) - VIWW</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>    <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;zone_percentage_VIWW&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">N_zones</span> <span class="o">/</span> <span class="n">n_voxels</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>    <span class="c1"># Grey Level Variance (GLV) - QK93</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>    <span class="n">mu_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">I</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;grey_level_variance_QK93&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">I</span> <span class="o">-</span> <span class="n">mu_i</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>    <span class="c1"># Zone Distance Variance (ZDV) - 7WT1</span>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a>    <span class="n">mu_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">J</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;zone_distance_variance_7WT1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">J</span> <span class="o">-</span> <span class="n">mu_j</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a>    <span class="c1"># Zone Distance Entropy (ZDE) - GBDU</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>    <span class="n">mask_p</span> <span class="o">=</span> <span class="n">P</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;zone_distance_entropy_GBDU&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">mask_p</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">mask_p</span><span class="p">]))</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>    <span class="c1"># Low Grey Level Zone Emphasis (LGLZE) - S1RA</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;low_grey_level_zone_emphasis_S1RA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">/</span> <span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>    <span class="c1"># High Grey Level Zone Emphasis (HGLZE) - K26C</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;high_grey_level_zone_emphasis_K26C&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>    <span class="c1"># Small Distance Low Grey Level Emphasis (SDLGLE) - RUVG</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;small_distance_low_grey_level_emphasis_RUVG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>        <span class="n">P</span> <span class="o">/</span> <span class="p">((</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>    <span class="p">)</span>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>    <span class="c1"># Small Distance High Grey Level Emphasis (SDHGLE) - DKNJ</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;small_distance_high_grey_level_emphasis_DKNJ&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>        <span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>    <span class="p">)</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a>    <span class="c1"># Large Distance Low Grey Level Emphasis (LDLGLE) - A7WM</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;large_distance_low_grey_level_emphasis_A7WM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>        <span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>    <span class="p">)</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>    <span class="c1"># Large Distance High Grey Level Emphasis (LDHGLE) - KLTH</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;large_distance_high_grey_level_emphasis_KLTH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
<a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>        <span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>    <span class="p">)</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633"></a>
<a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>    <span class="k">return</span> <span class="n">features</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pictologics.features.texture.calculate_glrlm_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_glrlm_features</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">,</span> <span class="n">glrlm_matrix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate Grey Level Run Length Matrix (GLRLM) features.</p>
<p>The GLRLM quantifies grey level runs, which are defined as the length in number of pixels,
of consecutive pixels that have the same grey level value.
This implementation computes features based on the 3D merged GLRLM (averaged over all 13 directions).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The 3D image array containing discretised grey levels.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mask</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The 3D binary mask array defining the ROI.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_bins</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of grey levels.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>glrlm_matrix</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-calculated GLRLM matrix.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, float]: A dictionary of calculated GLRLM features.
Example keys: 'short_runs_emphasis_22OV', 'grey_level_non_uniformity_R5YN'.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pictologics/features/texture.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1032" name="__codelineno-0-1032"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_glrlm_features</span><span class="p">(</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>    <span class="n">data</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>    <span class="n">mask</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>    <span class="n">n_bins</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>    <span class="n">glrlm_matrix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a><span class="sd">    Calculate Grey Level Run Length Matrix (GLRLM) features.</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a><span class="sd">    The GLRLM quantifies grey level runs, which are defined as the length in number of pixels,</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a><span class="sd">    of consecutive pixels that have the same grey level value.</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a><span class="sd">    This implementation computes features based on the 3D merged GLRLM (averaged over all 13 directions).</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a><span class="sd">        data (npt.NDArray[np.floating[Any]]): The 3D image array containing discretised grey levels.</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a><span class="sd">        mask (npt.NDArray[np.floating[Any]]): The 3D binary mask array defining the ROI.</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a><span class="sd">        n_bins (int): The number of grey levels.</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a><span class="sd">        glrlm_matrix (Optional[npt.NDArray[np.floating[Any]]]): Pre-calculated GLRLM matrix.</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a><span class="sd">        dict[str, float]: A dictionary of calculated GLRLM features.</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="sd">            Example keys: &#39;short_runs_emphasis_22OV&#39;, &#39;grey_level_non_uniformity_R5YN&#39;.</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>    <span class="k">if</span> <span class="n">glrlm_matrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>        <span class="k">if</span> <span class="n">n_bins</span> <span class="o">&lt;=</span> <span class="mi">256</span><span class="p">:</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>            <span class="n">data_int</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>            <span class="n">data_int</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>  <span class="c1"># pragma: no cover</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>        <span class="c1"># Determine n_threads for JIT call</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>            <span class="n">n_threads</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">numba</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">NUMBA_NUM_THREADS</span><span class="p">)</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>            <span class="n">n_threads</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Fallback</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>        <span class="c1"># Call combined kernel</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>        <span class="n">_</span><span class="p">,</span> <span class="n">glrlm</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_calculate_local_features_numba</span><span class="p">(</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>            <span class="n">data_int</span><span class="p">,</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>            <span class="n">mask</span><span class="p">,</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>            <span class="n">n_bins</span><span class="p">,</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>            <span class="n">calc_glcm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>            <span class="n">calc_glrlm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>            <span class="n">calc_ngtdm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>            <span class="n">calc_ngldm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>            <span class="n">offsets_26</span><span class="o">=</span><span class="n">OFFSETS_26</span><span class="p">,</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>            <span class="n">directions_13</span><span class="o">=</span><span class="n">DIRECTIONS_13</span><span class="p">,</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>            <span class="n">ngldm_alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>            <span class="n">n_threads</span><span class="o">=</span><span class="n">n_threads</span><span class="p">,</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>        <span class="p">)</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>        <span class="n">glrlm</span> <span class="o">=</span> <span class="n">glrlm_matrix</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>    <span class="c1"># Merge (Sum) -&gt; IAZD</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>    <span class="n">glrlm_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">glrlm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>    <span class="c1"># Remove length 0 (column 0)</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>    <span class="n">glrlm</span> <span class="o">=</span> <span class="n">glrlm_sum</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>    <span class="n">N_runs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">glrlm</span><span class="p">)</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>    <span class="k">if</span> <span class="n">N_runs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>        <span class="k">return</span> <span class="p">{}</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>    <span class="n">P</span> <span class="o">=</span> <span class="n">glrlm</span> <span class="o">/</span> <span class="n">N_runs</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>    <span class="n">n_g</span><span class="p">,</span> <span class="n">n_r</span> <span class="o">=</span> <span class="n">glrlm</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>    <span class="n">i_idx</span><span class="p">,</span> <span class="n">j_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">((</span><span class="n">n_g</span><span class="p">,</span> <span class="n">n_r</span><span class="p">))</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>    <span class="n">I</span> <span class="o">=</span> <span class="n">i_idx</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># noqa: E741</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>    <span class="n">J</span> <span class="o">=</span> <span class="n">j_idx</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>    <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>    <span class="c1"># Short Run Emphasis (SRE) - 22OV</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;short_runs_emphasis_22OV&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">/</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>    <span class="c1"># Long Run Emphasis (LRE) - W4KF</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;long_runs_emphasis_W4KF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>    <span class="c1"># Grey Level Non-Uniformity (GLNU) - R5YN</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>    <span class="n">s_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">glrlm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;grey_level_non_uniformity_R5YN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_i</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">N_runs</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>    <span class="c1"># Normalised Grey Level Non-Uniformity (GLNN) - OVBL</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;normalised_grey_level_non_uniformity_OVBL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_i</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N_runs</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>    <span class="c1"># Run Length Non-Uniformity (RLNU) - W92Y</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a>    <span class="n">s_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">glrlm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;run_length_non_uniformity_W92Y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_j</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">N_runs</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>    <span class="c1"># Normalised Run Length Non-Uniformity (RLNN) - IC23</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;normalised_run_length_non_uniformity_IC23&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_j</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N_runs</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>    <span class="c1"># Run Percentage (RP) - 9ZK5</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>    <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>    <span class="n">n_dirs</span> <span class="o">=</span> <span class="mi">13</span>  <span class="c1"># Fixed for 3D</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;run_percentage_9ZK5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">N_runs</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_voxels</span> <span class="o">*</span> <span class="n">n_dirs</span><span class="p">)</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>    <span class="c1"># Grey Level Variance (GLV) - 8CE5</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>    <span class="n">mu_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">I</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;grey_level_variance_8CE5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">I</span> <span class="o">-</span> <span class="n">mu_i</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>    <span class="c1"># Run Length Variance (RLV) - SXLW</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>    <span class="n">mu_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">J</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;run_length_variance_SXLW&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">J</span> <span class="o">-</span> <span class="n">mu_j</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>    <span class="c1"># Run Entropy (RE) - HJ9O</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>    <span class="n">mask_p</span> <span class="o">=</span> <span class="n">P</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;run_entropy_HJ9O&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">mask_p</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">mask_p</span><span class="p">]))</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>    <span class="c1"># Low Grey Level Run Emphasis (LGLRE) - V3SW</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;low_grey_level_run_emphasis_V3SW&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">/</span> <span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>    <span class="c1"># High Grey Level Run Emphasis (HGLRE) - G3QZ</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;high_grey_level_run_emphasis_G3QZ&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>    <span class="c1"># Short Run Low Grey Level Emphasis (SRLGLE) - HTZT</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;short_run_low_grey_level_emphasis_HTZT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">/</span> <span class="p">((</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>    <span class="c1"># Short Run High Grey Level Emphasis (SRHGLE) - GD3A</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;short_run_high_grey_level_emphasis_GD3A&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>    <span class="c1"># Long Run Low Grey Level Emphasis (LRLGLE) - IVPO</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;long_run_low_grey_level_emphasis_IVPO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>    <span class="c1"># Long Run High Grey Level Emphasis (LRHGLE) - 3KUM</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;long_run_high_grey_level_emphasis_3KUM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>    <span class="k">return</span> <span class="n">features</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pictologics.features.texture.calculate_glszm_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_glszm_features</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">,</span> <span class="n">glszm_matrix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate Grey Level Size Zone Matrix (GLSZM) features.</p>
<p>The GLSZM counts the number of zones (connected components) of linked voxels
that share the same grey level intensity. A zone is defined as a group of connected voxels
with the same grey level. This matrix is rotationally invariant by definition.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The 3D image array containing discretised grey levels.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mask</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The 3D binary mask array defining the ROI.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_bins</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of grey levels.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>glszm_matrix</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-calculated GLSZM matrix.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, float]: A dictionary of calculated GLSZM features.
Example keys: 'small_zone_emphasis_P001', 'zone_percentage_P30P'.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pictologics/features/texture.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1390" name="__codelineno-0-1390"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_glszm_features</span><span class="p">(</span>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a>    <span class="n">data</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a>    <span class="n">mask</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a>    <span class="n">n_bins</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>    <span class="n">glszm_matrix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a><span class="sd">    Calculate Grey Level Size Zone Matrix (GLSZM) features.</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a><span class="sd">    The GLSZM counts the number of zones (connected components) of linked voxels</span>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a><span class="sd">    that share the same grey level intensity. A zone is defined as a group of connected voxels</span>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a><span class="sd">    with the same grey level. This matrix is rotationally invariant by definition.</span>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a><span class="sd">        data (npt.NDArray[np.floating[Any]]): The 3D image array containing discretised grey levels.</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a><span class="sd">        mask (npt.NDArray[np.floating[Any]]): The 3D binary mask array defining the ROI.</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a><span class="sd">        n_bins (int): The number of grey levels.</span>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a><span class="sd">        glszm_matrix (Optional[npt.NDArray[np.floating[Any]]]): Pre-calculated GLSZM matrix.</span>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a><span class="sd">        dict[str, float]: A dictionary of calculated GLSZM features.</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a><span class="sd">            Example keys: &#39;small_zone_emphasis_P001&#39;, &#39;zone_percentage_P30P&#39;.</span>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a>    <span class="k">if</span> <span class="n">glszm_matrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a>        <span class="n">data_c</span><span class="p">,</span> <span class="n">mask_c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_maybe_crop_to_bbox</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>        <span class="k">if</span> <span class="n">mask_c</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>            <span class="n">mask_u8</span> <span class="o">=</span> <span class="n">mask_c</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a>            <span class="n">mask_u8</span> <span class="o">=</span> <span class="p">(</span><span class="n">mask_c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>        <span class="c1"># We need dist_map for the combined kernel signature, even if unused for GLSZM</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>        <span class="n">dummy_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">data_c</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a>        <span class="n">glszm</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">calculate_zone_features</span><span class="p">(</span>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>            <span class="n">data_c</span><span class="p">,</span> <span class="n">mask_u8</span><span class="p">,</span> <span class="n">dummy_dist</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">,</span> <span class="n">calc_glszm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">calc_gldzm</span><span class="o">=</span><span class="kc">False</span>  <span class="c1"># type: ignore[arg-type]</span>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a>        <span class="p">)</span>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a>        <span class="n">glszm</span> <span class="o">=</span> <span class="n">glszm_matrix</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a>    <span class="n">N_zones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">glszm</span><span class="p">)</span>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a>    <span class="k">if</span> <span class="n">N_zones</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a>        <span class="k">return</span> <span class="p">{}</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a>    <span class="n">P</span> <span class="o">=</span> <span class="n">glszm</span> <span class="o">/</span> <span class="n">N_zones</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a>    <span class="n">n_g</span><span class="p">,</span> <span class="n">n_s</span> <span class="o">=</span> <span class="n">glszm</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a>    <span class="n">i_idx</span><span class="p">,</span> <span class="n">j_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">((</span><span class="n">n_g</span><span class="p">,</span> <span class="n">n_s</span><span class="p">))</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a>    <span class="n">I</span> <span class="o">=</span> <span class="n">i_idx</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># noqa: E741</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a>    <span class="n">J</span> <span class="o">=</span> <span class="n">j_idx</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Zone size</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a>    <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a>    <span class="c1"># Small Zone Emphasis (SZE) - P001</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;small_zone_emphasis_P001&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">/</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>    <span class="c1"># Large Zone Emphasis (LZE) - 48P8</span>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;large_zone_emphasis_48P8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a>    <span class="c1"># Grey Level Non-Uniformity (GLNU) - JNSA</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a>    <span class="n">s_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">glszm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;grey_level_non_uniformity_JNSA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_i</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">N_zones</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>    <span class="c1"># Normalised Grey Level Non-Uniformity (GLNN) - Y1RO</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;normalised_grey_level_non_uniformity_Y1RO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_i</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>        <span class="n">N_zones</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>    <span class="p">)</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a>    <span class="c1"># Zone Size Non-Uniformity (ZSNU) - 4JP3</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a>    <span class="n">s_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">glszm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;zone_size_non_uniformity_4JP3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_j</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">N_zones</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a>    <span class="c1"># Normalised Zone Size Non-Uniformity (ZSNN) - VB3A</span>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;normalised_zone_size_non_uniformity_VB3A&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_j</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N_zones</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a>    <span class="c1"># Zone Percentage (ZP) - P30P</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>    <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;zone_percentage_P30P&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">N_zones</span> <span class="o">/</span> <span class="n">n_voxels</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>    <span class="c1"># Grey Level Variance (GLV) - BYLV</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a>    <span class="n">mu_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">I</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;grey_level_variance_BYLV&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">I</span> <span class="o">-</span> <span class="n">mu_i</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a>    <span class="c1"># Zone Size Variance (ZSV) - 3NSA</span>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a>    <span class="n">mu_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">J</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;zone_size_variance_3NSA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">J</span> <span class="o">-</span> <span class="n">mu_j</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a>    <span class="c1"># Zone Size Entropy (ZSE) - GU8N</span>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a>    <span class="n">mask_p</span> <span class="o">=</span> <span class="n">P</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;zone_size_entropy_GU8N&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">mask_p</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">mask_p</span><span class="p">]))</span>
<a id="__codelineno-0-1479" name="__codelineno-0-1479"></a>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a>    <span class="c1"># Low Grey Level Zone Emphasis (LGLZE) - XMSY</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;low_grey_level_zone_emphasis_XMSY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">/</span> <span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a>    <span class="c1"># High Grey Level Zone Emphasis (HGLZE) - 5GN9</span>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;high_grey_level_zone_emphasis_5GN9&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a>    <span class="c1"># Small Zone Low Grey Level Emphasis (SZLGLE) - 5RAI</span>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;small_zone_low_grey_level_emphasis_5RAI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">/</span> <span class="p">((</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a>
<a id="__codelineno-0-1489" name="__codelineno-0-1489"></a>    <span class="c1"># Small Zone High Grey Level Emphasis (SZHGLE) - HW1V</span>
<a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;small_zone_high_grey_level_emphasis_HW1V&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a>    <span class="c1"># Large Zone Low Grey Level Emphasis (LZLGLE) - YH51</span>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;large_zone_low_grey_level_emphasis_YH51&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>    <span class="c1"># Large Zone High Grey Level Emphasis (LZHGLE) - J17V</span>
<a id="__codelineno-0-1496" name="__codelineno-0-1496"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;large_zone_high_grey_level_emphasis_J17V&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a>    <span class="k">return</span> <span class="n">features</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pictologics.features.texture.calculate_ngldm_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_ngldm_features</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">,</span> <span class="n">ngldm_matrix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ngldm_alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate Neighbourhood Grey Level Dependence Matrix (NGLDM) features.</p>
<p>The NGLDM captures the dependence of grey levels on their neighbours.
A "dependence" is defined as a connected voxel having a similar grey level (within a tolerance α).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The 3D image array containing discretised grey levels.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mask</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The 3D binary mask array defining the ROI.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_bins</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of grey levels.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ngldm_matrix</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-calculated NGLDM matrix.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ngldm_alpha</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The coarseness parameter α. Two grey levels are considered dependent
if their absolute difference is ≤ α. Default is 0 (exact match, IBSI standard).</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, float]: A dictionary of calculated NGLDM features.
Example keys: 'low_dependence_emphasis_SODN', 'dependence_count_entropy_FCBV'.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pictologics/features/texture.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1781">1781</a></span>
<span class="normal"><a href="#__codelineno-0-1782">1782</a></span>
<span class="normal"><a href="#__codelineno-0-1783">1783</a></span>
<span class="normal"><a href="#__codelineno-0-1784">1784</a></span>
<span class="normal"><a href="#__codelineno-0-1785">1785</a></span>
<span class="normal"><a href="#__codelineno-0-1786">1786</a></span>
<span class="normal"><a href="#__codelineno-0-1787">1787</a></span>
<span class="normal"><a href="#__codelineno-0-1788">1788</a></span>
<span class="normal"><a href="#__codelineno-0-1789">1789</a></span>
<span class="normal"><a href="#__codelineno-0-1790">1790</a></span>
<span class="normal"><a href="#__codelineno-0-1791">1791</a></span>
<span class="normal"><a href="#__codelineno-0-1792">1792</a></span>
<span class="normal"><a href="#__codelineno-0-1793">1793</a></span>
<span class="normal"><a href="#__codelineno-0-1794">1794</a></span>
<span class="normal"><a href="#__codelineno-0-1795">1795</a></span>
<span class="normal"><a href="#__codelineno-0-1796">1796</a></span>
<span class="normal"><a href="#__codelineno-0-1797">1797</a></span>
<span class="normal"><a href="#__codelineno-0-1798">1798</a></span>
<span class="normal"><a href="#__codelineno-0-1799">1799</a></span>
<span class="normal"><a href="#__codelineno-0-1800">1800</a></span>
<span class="normal"><a href="#__codelineno-0-1801">1801</a></span>
<span class="normal"><a href="#__codelineno-0-1802">1802</a></span>
<span class="normal"><a href="#__codelineno-0-1803">1803</a></span>
<span class="normal"><a href="#__codelineno-0-1804">1804</a></span>
<span class="normal"><a href="#__codelineno-0-1805">1805</a></span>
<span class="normal"><a href="#__codelineno-0-1806">1806</a></span>
<span class="normal"><a href="#__codelineno-0-1807">1807</a></span>
<span class="normal"><a href="#__codelineno-0-1808">1808</a></span>
<span class="normal"><a href="#__codelineno-0-1809">1809</a></span>
<span class="normal"><a href="#__codelineno-0-1810">1810</a></span>
<span class="normal"><a href="#__codelineno-0-1811">1811</a></span>
<span class="normal"><a href="#__codelineno-0-1812">1812</a></span>
<span class="normal"><a href="#__codelineno-0-1813">1813</a></span>
<span class="normal"><a href="#__codelineno-0-1814">1814</a></span>
<span class="normal"><a href="#__codelineno-0-1815">1815</a></span>
<span class="normal"><a href="#__codelineno-0-1816">1816</a></span>
<span class="normal"><a href="#__codelineno-0-1817">1817</a></span>
<span class="normal"><a href="#__codelineno-0-1818">1818</a></span>
<span class="normal"><a href="#__codelineno-0-1819">1819</a></span>
<span class="normal"><a href="#__codelineno-0-1820">1820</a></span>
<span class="normal"><a href="#__codelineno-0-1821">1821</a></span>
<span class="normal"><a href="#__codelineno-0-1822">1822</a></span>
<span class="normal"><a href="#__codelineno-0-1823">1823</a></span>
<span class="normal"><a href="#__codelineno-0-1824">1824</a></span>
<span class="normal"><a href="#__codelineno-0-1825">1825</a></span>
<span class="normal"><a href="#__codelineno-0-1826">1826</a></span>
<span class="normal"><a href="#__codelineno-0-1827">1827</a></span>
<span class="normal"><a href="#__codelineno-0-1828">1828</a></span>
<span class="normal"><a href="#__codelineno-0-1829">1829</a></span>
<span class="normal"><a href="#__codelineno-0-1830">1830</a></span>
<span class="normal"><a href="#__codelineno-0-1831">1831</a></span>
<span class="normal"><a href="#__codelineno-0-1832">1832</a></span>
<span class="normal"><a href="#__codelineno-0-1833">1833</a></span>
<span class="normal"><a href="#__codelineno-0-1834">1834</a></span>
<span class="normal"><a href="#__codelineno-0-1835">1835</a></span>
<span class="normal"><a href="#__codelineno-0-1836">1836</a></span>
<span class="normal"><a href="#__codelineno-0-1837">1837</a></span>
<span class="normal"><a href="#__codelineno-0-1838">1838</a></span>
<span class="normal"><a href="#__codelineno-0-1839">1839</a></span>
<span class="normal"><a href="#__codelineno-0-1840">1840</a></span>
<span class="normal"><a href="#__codelineno-0-1841">1841</a></span>
<span class="normal"><a href="#__codelineno-0-1842">1842</a></span>
<span class="normal"><a href="#__codelineno-0-1843">1843</a></span>
<span class="normal"><a href="#__codelineno-0-1844">1844</a></span>
<span class="normal"><a href="#__codelineno-0-1845">1845</a></span>
<span class="normal"><a href="#__codelineno-0-1846">1846</a></span>
<span class="normal"><a href="#__codelineno-0-1847">1847</a></span>
<span class="normal"><a href="#__codelineno-0-1848">1848</a></span>
<span class="normal"><a href="#__codelineno-0-1849">1849</a></span>
<span class="normal"><a href="#__codelineno-0-1850">1850</a></span>
<span class="normal"><a href="#__codelineno-0-1851">1851</a></span>
<span class="normal"><a href="#__codelineno-0-1852">1852</a></span>
<span class="normal"><a href="#__codelineno-0-1853">1853</a></span>
<span class="normal"><a href="#__codelineno-0-1854">1854</a></span>
<span class="normal"><a href="#__codelineno-0-1855">1855</a></span>
<span class="normal"><a href="#__codelineno-0-1856">1856</a></span>
<span class="normal"><a href="#__codelineno-0-1857">1857</a></span>
<span class="normal"><a href="#__codelineno-0-1858">1858</a></span>
<span class="normal"><a href="#__codelineno-0-1859">1859</a></span>
<span class="normal"><a href="#__codelineno-0-1860">1860</a></span>
<span class="normal"><a href="#__codelineno-0-1861">1861</a></span>
<span class="normal"><a href="#__codelineno-0-1862">1862</a></span>
<span class="normal"><a href="#__codelineno-0-1863">1863</a></span>
<span class="normal"><a href="#__codelineno-0-1864">1864</a></span>
<span class="normal"><a href="#__codelineno-0-1865">1865</a></span>
<span class="normal"><a href="#__codelineno-0-1866">1866</a></span>
<span class="normal"><a href="#__codelineno-0-1867">1867</a></span>
<span class="normal"><a href="#__codelineno-0-1868">1868</a></span>
<span class="normal"><a href="#__codelineno-0-1869">1869</a></span>
<span class="normal"><a href="#__codelineno-0-1870">1870</a></span>
<span class="normal"><a href="#__codelineno-0-1871">1871</a></span>
<span class="normal"><a href="#__codelineno-0-1872">1872</a></span>
<span class="normal"><a href="#__codelineno-0-1873">1873</a></span>
<span class="normal"><a href="#__codelineno-0-1874">1874</a></span>
<span class="normal"><a href="#__codelineno-0-1875">1875</a></span>
<span class="normal"><a href="#__codelineno-0-1876">1876</a></span>
<span class="normal"><a href="#__codelineno-0-1877">1877</a></span>
<span class="normal"><a href="#__codelineno-0-1878">1878</a></span>
<span class="normal"><a href="#__codelineno-0-1879">1879</a></span>
<span class="normal"><a href="#__codelineno-0-1880">1880</a></span>
<span class="normal"><a href="#__codelineno-0-1881">1881</a></span>
<span class="normal"><a href="#__codelineno-0-1882">1882</a></span>
<span class="normal"><a href="#__codelineno-0-1883">1883</a></span>
<span class="normal"><a href="#__codelineno-0-1884">1884</a></span>
<span class="normal"><a href="#__codelineno-0-1885">1885</a></span>
<span class="normal"><a href="#__codelineno-0-1886">1886</a></span>
<span class="normal"><a href="#__codelineno-0-1887">1887</a></span>
<span class="normal"><a href="#__codelineno-0-1888">1888</a></span>
<span class="normal"><a href="#__codelineno-0-1889">1889</a></span>
<span class="normal"><a href="#__codelineno-0-1890">1890</a></span>
<span class="normal"><a href="#__codelineno-0-1891">1891</a></span>
<span class="normal"><a href="#__codelineno-0-1892">1892</a></span>
<span class="normal"><a href="#__codelineno-0-1893">1893</a></span>
<span class="normal"><a href="#__codelineno-0-1894">1894</a></span>
<span class="normal"><a href="#__codelineno-0-1895">1895</a></span>
<span class="normal"><a href="#__codelineno-0-1896">1896</a></span>
<span class="normal"><a href="#__codelineno-0-1897">1897</a></span>
<span class="normal"><a href="#__codelineno-0-1898">1898</a></span>
<span class="normal"><a href="#__codelineno-0-1899">1899</a></span>
<span class="normal"><a href="#__codelineno-0-1900">1900</a></span>
<span class="normal"><a href="#__codelineno-0-1901">1901</a></span>
<span class="normal"><a href="#__codelineno-0-1902">1902</a></span>
<span class="normal"><a href="#__codelineno-0-1903">1903</a></span>
<span class="normal"><a href="#__codelineno-0-1904">1904</a></span>
<span class="normal"><a href="#__codelineno-0-1905">1905</a></span>
<span class="normal"><a href="#__codelineno-0-1906">1906</a></span>
<span class="normal"><a href="#__codelineno-0-1907">1907</a></span>
<span class="normal"><a href="#__codelineno-0-1908">1908</a></span>
<span class="normal"><a href="#__codelineno-0-1909">1909</a></span>
<span class="normal"><a href="#__codelineno-0-1910">1910</a></span>
<span class="normal"><a href="#__codelineno-0-1911">1911</a></span>
<span class="normal"><a href="#__codelineno-0-1912">1912</a></span>
<span class="normal"><a href="#__codelineno-0-1913">1913</a></span>
<span class="normal"><a href="#__codelineno-0-1914">1914</a></span>
<span class="normal"><a href="#__codelineno-0-1915">1915</a></span>
<span class="normal"><a href="#__codelineno-0-1916">1916</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1781" name="__codelineno-0-1781"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_ngldm_features</span><span class="p">(</span>
<a id="__codelineno-0-1782" name="__codelineno-0-1782"></a>    <span class="n">data</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
<a id="__codelineno-0-1783" name="__codelineno-0-1783"></a>    <span class="n">mask</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
<a id="__codelineno-0-1784" name="__codelineno-0-1784"></a>    <span class="n">n_bins</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-1785" name="__codelineno-0-1785"></a>    <span class="n">ngldm_matrix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1786" name="__codelineno-0-1786"></a>    <span class="n">ngldm_alpha</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-1787" name="__codelineno-0-1787"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-1788" name="__codelineno-0-1788"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1789" name="__codelineno-0-1789"></a><span class="sd">    Calculate Neighbourhood Grey Level Dependence Matrix (NGLDM) features.</span>
<a id="__codelineno-0-1790" name="__codelineno-0-1790"></a>
<a id="__codelineno-0-1791" name="__codelineno-0-1791"></a><span class="sd">    The NGLDM captures the dependence of grey levels on their neighbours.</span>
<a id="__codelineno-0-1792" name="__codelineno-0-1792"></a><span class="sd">    A &quot;dependence&quot; is defined as a connected voxel having a similar grey level (within a tolerance α).</span>
<a id="__codelineno-0-1793" name="__codelineno-0-1793"></a>
<a id="__codelineno-0-1794" name="__codelineno-0-1794"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1795" name="__codelineno-0-1795"></a><span class="sd">        data (npt.NDArray[np.floating[Any]]): The 3D image array containing discretised grey levels.</span>
<a id="__codelineno-0-1796" name="__codelineno-0-1796"></a><span class="sd">        mask (npt.NDArray[np.floating[Any]]): The 3D binary mask array defining the ROI.</span>
<a id="__codelineno-0-1797" name="__codelineno-0-1797"></a><span class="sd">        n_bins (int): The number of grey levels.</span>
<a id="__codelineno-0-1798" name="__codelineno-0-1798"></a><span class="sd">        ngldm_matrix (Optional[npt.NDArray[np.floating[Any]]]): Pre-calculated NGLDM matrix.</span>
<a id="__codelineno-0-1799" name="__codelineno-0-1799"></a><span class="sd">        ngldm_alpha (int): The coarseness parameter α. Two grey levels are considered dependent</span>
<a id="__codelineno-0-1800" name="__codelineno-0-1800"></a><span class="sd">            if their absolute difference is ≤ α. Default is 0 (exact match, IBSI standard).</span>
<a id="__codelineno-0-1801" name="__codelineno-0-1801"></a>
<a id="__codelineno-0-1802" name="__codelineno-0-1802"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1803" name="__codelineno-0-1803"></a><span class="sd">        dict[str, float]: A dictionary of calculated NGLDM features.</span>
<a id="__codelineno-0-1804" name="__codelineno-0-1804"></a><span class="sd">            Example keys: &#39;low_dependence_emphasis_SODN&#39;, &#39;dependence_count_entropy_FCBV&#39;.</span>
<a id="__codelineno-0-1805" name="__codelineno-0-1805"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1806" name="__codelineno-0-1806"></a>    <span class="k">if</span> <span class="n">ngldm_matrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1807" name="__codelineno-0-1807"></a>        <span class="k">if</span> <span class="n">n_bins</span> <span class="o">&lt;=</span> <span class="mi">256</span><span class="p">:</span>
<a id="__codelineno-0-1808" name="__codelineno-0-1808"></a>            <span class="n">data_int</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1809" name="__codelineno-0-1809"></a>        <span class="k">elif</span> <span class="n">n_bins</span> <span class="o">&lt;=</span> <span class="mi">65536</span><span class="p">:</span>
<a id="__codelineno-0-1810" name="__codelineno-0-1810"></a>            <span class="n">data_int</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
<a id="__codelineno-0-1811" name="__codelineno-0-1811"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1812" name="__codelineno-0-1812"></a>            <span class="n">data_int</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>  <span class="c1"># pragma: no cover</span>
<a id="__codelineno-0-1813" name="__codelineno-0-1813"></a>
<a id="__codelineno-0-1814" name="__codelineno-0-1814"></a>        <span class="c1"># Determine n_threads for JIT call</span>
<a id="__codelineno-0-1815" name="__codelineno-0-1815"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1816" name="__codelineno-0-1816"></a>            <span class="n">n_threads</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">numba</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">NUMBA_NUM_THREADS</span><span class="p">)</span>
<a id="__codelineno-0-1817" name="__codelineno-0-1817"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
<a id="__codelineno-0-1818" name="__codelineno-0-1818"></a>            <span class="n">n_threads</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Fallback</span>
<a id="__codelineno-0-1819" name="__codelineno-0-1819"></a>
<a id="__codelineno-0-1820" name="__codelineno-0-1820"></a>        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ngldm</span> <span class="o">=</span> <span class="n">_calculate_local_features_numba</span><span class="p">(</span>
<a id="__codelineno-0-1821" name="__codelineno-0-1821"></a>            <span class="n">data_int</span><span class="p">,</span>
<a id="__codelineno-0-1822" name="__codelineno-0-1822"></a>            <span class="n">mask</span><span class="p">,</span>
<a id="__codelineno-0-1823" name="__codelineno-0-1823"></a>            <span class="n">n_bins</span><span class="p">,</span>
<a id="__codelineno-0-1824" name="__codelineno-0-1824"></a>            <span class="n">calc_glcm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1825" name="__codelineno-0-1825"></a>            <span class="n">calc_glrlm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1826" name="__codelineno-0-1826"></a>            <span class="n">calc_ngtdm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1827" name="__codelineno-0-1827"></a>            <span class="n">calc_ngldm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1828" name="__codelineno-0-1828"></a>            <span class="n">offsets_26</span><span class="o">=</span><span class="n">OFFSETS_26</span><span class="p">,</span>
<a id="__codelineno-0-1829" name="__codelineno-0-1829"></a>            <span class="n">directions_13</span><span class="o">=</span><span class="n">DIRECTIONS_13</span><span class="p">,</span>
<a id="__codelineno-0-1830" name="__codelineno-0-1830"></a>            <span class="n">ngldm_alpha</span><span class="o">=</span><span class="n">ngldm_alpha</span><span class="p">,</span>
<a id="__codelineno-0-1831" name="__codelineno-0-1831"></a>            <span class="n">n_threads</span><span class="o">=</span><span class="n">n_threads</span><span class="p">,</span>
<a id="__codelineno-0-1832" name="__codelineno-0-1832"></a>        <span class="p">)</span>
<a id="__codelineno-0-1833" name="__codelineno-0-1833"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1834" name="__codelineno-0-1834"></a>        <span class="n">ngldm</span> <span class="o">=</span> <span class="n">ngldm_matrix</span>
<a id="__codelineno-0-1835" name="__codelineno-0-1835"></a>
<a id="__codelineno-0-1836" name="__codelineno-0-1836"></a>    <span class="n">N_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ngldm</span><span class="p">)</span>
<a id="__codelineno-0-1837" name="__codelineno-0-1837"></a>    <span class="k">if</span> <span class="n">N_s</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1838" name="__codelineno-0-1838"></a>        <span class="k">return</span> <span class="p">{}</span>
<a id="__codelineno-0-1839" name="__codelineno-0-1839"></a>
<a id="__codelineno-0-1840" name="__codelineno-0-1840"></a>    <span class="n">P</span> <span class="o">=</span> <span class="n">ngldm</span> <span class="o">/</span> <span class="n">N_s</span>
<a id="__codelineno-0-1841" name="__codelineno-0-1841"></a>
<a id="__codelineno-0-1842" name="__codelineno-0-1842"></a>    <span class="n">n_g</span><span class="p">,</span> <span class="n">n_d</span> <span class="o">=</span> <span class="n">ngldm</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-1843" name="__codelineno-0-1843"></a>    <span class="n">i_idx</span><span class="p">,</span> <span class="n">j_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">((</span><span class="n">n_g</span><span class="p">,</span> <span class="n">n_d</span><span class="p">))</span>
<a id="__codelineno-0-1844" name="__codelineno-0-1844"></a>    <span class="n">I</span> <span class="o">=</span> <span class="n">i_idx</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># noqa: E741</span>
<a id="__codelineno-0-1845" name="__codelineno-0-1845"></a>    <span class="n">J</span> <span class="o">=</span> <span class="n">j_idx</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Dependence count</span>
<a id="__codelineno-0-1846" name="__codelineno-0-1846"></a>
<a id="__codelineno-0-1847" name="__codelineno-0-1847"></a>    <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1848" name="__codelineno-0-1848"></a>
<a id="__codelineno-0-1849" name="__codelineno-0-1849"></a>    <span class="c1"># Low Dependence Emphasis (LDE) - SODN</span>
<a id="__codelineno-0-1850" name="__codelineno-0-1850"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;low_dependence_emphasis_SODN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">/</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1851" name="__codelineno-0-1851"></a>
<a id="__codelineno-0-1852" name="__codelineno-0-1852"></a>    <span class="c1"># High Dependence Emphasis (HDE) - IMOQ</span>
<a id="__codelineno-0-1853" name="__codelineno-0-1853"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;high_dependence_emphasis_IMOQ&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1854" name="__codelineno-0-1854"></a>
<a id="__codelineno-0-1855" name="__codelineno-0-1855"></a>    <span class="c1"># Low Grey Level Count Emphasis (LGCE) - TL9H</span>
<a id="__codelineno-0-1856" name="__codelineno-0-1856"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;low_grey_level_count_emphasis_TL9H&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">/</span> <span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1857" name="__codelineno-0-1857"></a>
<a id="__codelineno-0-1858" name="__codelineno-0-1858"></a>    <span class="c1"># High Grey Level Count Emphasis (HGCE) - OAE7</span>
<a id="__codelineno-0-1859" name="__codelineno-0-1859"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;high_grey_level_count_emphasis_OAE7&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1860" name="__codelineno-0-1860"></a>
<a id="__codelineno-0-1861" name="__codelineno-0-1861"></a>    <span class="c1"># Low Dependence Low Grey Level Emphasis (LDLGE) - EQ3F</span>
<a id="__codelineno-0-1862" name="__codelineno-0-1862"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;low_dependence_low_grey_level_emphasis_EQ3F&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
<a id="__codelineno-0-1863" name="__codelineno-0-1863"></a>        <span class="n">P</span> <span class="o">/</span> <span class="p">((</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1864" name="__codelineno-0-1864"></a>    <span class="p">)</span>
<a id="__codelineno-0-1865" name="__codelineno-0-1865"></a>
<a id="__codelineno-0-1866" name="__codelineno-0-1866"></a>    <span class="c1"># Low Dependence High Grey Level Emphasis (LDHGE) - JA6D</span>
<a id="__codelineno-0-1867" name="__codelineno-0-1867"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;low_dependence_high_grey_level_emphasis_JA6D&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
<a id="__codelineno-0-1868" name="__codelineno-0-1868"></a>        <span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1869" name="__codelineno-0-1869"></a>    <span class="p">)</span>
<a id="__codelineno-0-1870" name="__codelineno-0-1870"></a>
<a id="__codelineno-0-1871" name="__codelineno-0-1871"></a>    <span class="c1"># High Dependence Low Grey Level Emphasis (HDLGE) - NBZI</span>
<a id="__codelineno-0-1872" name="__codelineno-0-1872"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;high_dependence_low_grey_level_emphasis_NBZI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
<a id="__codelineno-0-1873" name="__codelineno-0-1873"></a>        <span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1874" name="__codelineno-0-1874"></a>    <span class="p">)</span>
<a id="__codelineno-0-1875" name="__codelineno-0-1875"></a>
<a id="__codelineno-0-1876" name="__codelineno-0-1876"></a>    <span class="c1"># High Dependence High Grey Level Emphasis (HDHGE) - 9QMG</span>
<a id="__codelineno-0-1877" name="__codelineno-0-1877"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;high_dependence_high_grey_level_emphasis_9QMG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
<a id="__codelineno-0-1878" name="__codelineno-0-1878"></a>        <span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">I</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">J</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1879" name="__codelineno-0-1879"></a>    <span class="p">)</span>
<a id="__codelineno-0-1880" name="__codelineno-0-1880"></a>
<a id="__codelineno-0-1881" name="__codelineno-0-1881"></a>    <span class="c1"># Grey Level Non-Uniformity - FP8K</span>
<a id="__codelineno-0-1882" name="__codelineno-0-1882"></a>    <span class="n">s_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ngldm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1883" name="__codelineno-0-1883"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;grey_level_non_uniformity_FP8K&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_i</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">N_s</span>
<a id="__codelineno-0-1884" name="__codelineno-0-1884"></a>
<a id="__codelineno-0-1885" name="__codelineno-0-1885"></a>    <span class="c1"># Normalised Grey Level Non-Uniformity - 5SPA</span>
<a id="__codelineno-0-1886" name="__codelineno-0-1886"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;normalised_grey_level_non_uniformity_5SPA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_i</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N_s</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1887" name="__codelineno-0-1887"></a>
<a id="__codelineno-0-1888" name="__codelineno-0-1888"></a>    <span class="c1"># Dependence Count Non-Uniformity - Z87G</span>
<a id="__codelineno-0-1889" name="__codelineno-0-1889"></a>    <span class="n">s_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ngldm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1890" name="__codelineno-0-1890"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;dependence_count_non_uniformity_Z87G&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_j</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">N_s</span>
<a id="__codelineno-0-1891" name="__codelineno-0-1891"></a>
<a id="__codelineno-0-1892" name="__codelineno-0-1892"></a>    <span class="c1"># Normalised Dependence Count Non-Uniformity - OKJI</span>
<a id="__codelineno-0-1893" name="__codelineno-0-1893"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;normalised_dependence_count_non_uniformity_OKJI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_j</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
<a id="__codelineno-0-1894" name="__codelineno-0-1894"></a>        <span class="n">N_s</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-0-1895" name="__codelineno-0-1895"></a>    <span class="p">)</span>
<a id="__codelineno-0-1896" name="__codelineno-0-1896"></a>
<a id="__codelineno-0-1897" name="__codelineno-0-1897"></a>    <span class="c1"># Dependence Count Percentage - 6XV8</span>
<a id="__codelineno-0-1898" name="__codelineno-0-1898"></a>    <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<a id="__codelineno-0-1899" name="__codelineno-0-1899"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;dependence_count_percentage_6XV8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">N_s</span> <span class="o">/</span> <span class="n">n_voxels</span>
<a id="__codelineno-0-1900" name="__codelineno-0-1900"></a>
<a id="__codelineno-0-1901" name="__codelineno-0-1901"></a>    <span class="c1"># Grey Level Variance - 1PFV</span>
<a id="__codelineno-0-1902" name="__codelineno-0-1902"></a>    <span class="n">mu_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">I</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-1903" name="__codelineno-0-1903"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;grey_level_variance_1PFV&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">I</span> <span class="o">-</span> <span class="n">mu_i</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-1904" name="__codelineno-0-1904"></a>
<a id="__codelineno-0-1905" name="__codelineno-0-1905"></a>    <span class="c1"># Dependence Count Variance - DNX2</span>
<a id="__codelineno-0-1906" name="__codelineno-0-1906"></a>    <span class="n">mu_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">J</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-1907" name="__codelineno-0-1907"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;dependence_count_variance_DNX2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">J</span> <span class="o">-</span> <span class="n">mu_j</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-1908" name="__codelineno-0-1908"></a>
<a id="__codelineno-0-1909" name="__codelineno-0-1909"></a>    <span class="c1"># Dependence Count Entropy - FCBV</span>
<a id="__codelineno-0-1910" name="__codelineno-0-1910"></a>    <span class="n">mask_p</span> <span class="o">=</span> <span class="n">P</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-1911" name="__codelineno-0-1911"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;dependence_count_entropy_FCBV&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">mask_p</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">mask_p</span><span class="p">]))</span>
<a id="__codelineno-0-1912" name="__codelineno-0-1912"></a>
<a id="__codelineno-0-1913" name="__codelineno-0-1913"></a>    <span class="c1"># Dependence Count Energy - CAS9</span>
<a id="__codelineno-0-1914" name="__codelineno-0-1914"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;dependence_count_energy_CAS9&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1915" name="__codelineno-0-1915"></a>
<a id="__codelineno-0-1916" name="__codelineno-0-1916"></a>    <span class="k">return</span> <span class="n">features</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pictologics.features.texture.calculate_ngtdm_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_ngtdm_features</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">,</span> <span class="n">ngtdm_matrices</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate Neighbourhood Grey Tone Difference Matrix (NGTDM) features.</p>
<p>The NGTDM quantifies the difference between a grey value and the average grey value
of its neighbours. It captures the coarseness and contrast of the texture.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The 3D image array containing discretised grey levels.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mask</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The 3D binary mask array defining the ROI.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_bins</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of grey levels.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ngtdm_matrices</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="tuple">tuple</span>[<span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]], <span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-calculated NGTDM matrices
(sum of absolute differences <code>s</code>, and count <code>n</code>).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, float]: A dictionary of calculated NGTDM features.
Example keys: 'coarseness_QCDE', 'contrast_65HE', 'busyness_NQ30'.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pictologics/features/texture.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span>
<span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span>
<span class="normal"><a href="#__codelineno-0-1705">1705</a></span>
<span class="normal"><a href="#__codelineno-0-1706">1706</a></span>
<span class="normal"><a href="#__codelineno-0-1707">1707</a></span>
<span class="normal"><a href="#__codelineno-0-1708">1708</a></span>
<span class="normal"><a href="#__codelineno-0-1709">1709</a></span>
<span class="normal"><a href="#__codelineno-0-1710">1710</a></span>
<span class="normal"><a href="#__codelineno-0-1711">1711</a></span>
<span class="normal"><a href="#__codelineno-0-1712">1712</a></span>
<span class="normal"><a href="#__codelineno-0-1713">1713</a></span>
<span class="normal"><a href="#__codelineno-0-1714">1714</a></span>
<span class="normal"><a href="#__codelineno-0-1715">1715</a></span>
<span class="normal"><a href="#__codelineno-0-1716">1716</a></span>
<span class="normal"><a href="#__codelineno-0-1717">1717</a></span>
<span class="normal"><a href="#__codelineno-0-1718">1718</a></span>
<span class="normal"><a href="#__codelineno-0-1719">1719</a></span>
<span class="normal"><a href="#__codelineno-0-1720">1720</a></span>
<span class="normal"><a href="#__codelineno-0-1721">1721</a></span>
<span class="normal"><a href="#__codelineno-0-1722">1722</a></span>
<span class="normal"><a href="#__codelineno-0-1723">1723</a></span>
<span class="normal"><a href="#__codelineno-0-1724">1724</a></span>
<span class="normal"><a href="#__codelineno-0-1725">1725</a></span>
<span class="normal"><a href="#__codelineno-0-1726">1726</a></span>
<span class="normal"><a href="#__codelineno-0-1727">1727</a></span>
<span class="normal"><a href="#__codelineno-0-1728">1728</a></span>
<span class="normal"><a href="#__codelineno-0-1729">1729</a></span>
<span class="normal"><a href="#__codelineno-0-1730">1730</a></span>
<span class="normal"><a href="#__codelineno-0-1731">1731</a></span>
<span class="normal"><a href="#__codelineno-0-1732">1732</a></span>
<span class="normal"><a href="#__codelineno-0-1733">1733</a></span>
<span class="normal"><a href="#__codelineno-0-1734">1734</a></span>
<span class="normal"><a href="#__codelineno-0-1735">1735</a></span>
<span class="normal"><a href="#__codelineno-0-1736">1736</a></span>
<span class="normal"><a href="#__codelineno-0-1737">1737</a></span>
<span class="normal"><a href="#__codelineno-0-1738">1738</a></span>
<span class="normal"><a href="#__codelineno-0-1739">1739</a></span>
<span class="normal"><a href="#__codelineno-0-1740">1740</a></span>
<span class="normal"><a href="#__codelineno-0-1741">1741</a></span>
<span class="normal"><a href="#__codelineno-0-1742">1742</a></span>
<span class="normal"><a href="#__codelineno-0-1743">1743</a></span>
<span class="normal"><a href="#__codelineno-0-1744">1744</a></span>
<span class="normal"><a href="#__codelineno-0-1745">1745</a></span>
<span class="normal"><a href="#__codelineno-0-1746">1746</a></span>
<span class="normal"><a href="#__codelineno-0-1747">1747</a></span>
<span class="normal"><a href="#__codelineno-0-1748">1748</a></span>
<span class="normal"><a href="#__codelineno-0-1749">1749</a></span>
<span class="normal"><a href="#__codelineno-0-1750">1750</a></span>
<span class="normal"><a href="#__codelineno-0-1751">1751</a></span>
<span class="normal"><a href="#__codelineno-0-1752">1752</a></span>
<span class="normal"><a href="#__codelineno-0-1753">1753</a></span>
<span class="normal"><a href="#__codelineno-0-1754">1754</a></span>
<span class="normal"><a href="#__codelineno-0-1755">1755</a></span>
<span class="normal"><a href="#__codelineno-0-1756">1756</a></span>
<span class="normal"><a href="#__codelineno-0-1757">1757</a></span>
<span class="normal"><a href="#__codelineno-0-1758">1758</a></span>
<span class="normal"><a href="#__codelineno-0-1759">1759</a></span>
<span class="normal"><a href="#__codelineno-0-1760">1760</a></span>
<span class="normal"><a href="#__codelineno-0-1761">1761</a></span>
<span class="normal"><a href="#__codelineno-0-1762">1762</a></span>
<span class="normal"><a href="#__codelineno-0-1763">1763</a></span>
<span class="normal"><a href="#__codelineno-0-1764">1764</a></span>
<span class="normal"><a href="#__codelineno-0-1765">1765</a></span>
<span class="normal"><a href="#__codelineno-0-1766">1766</a></span>
<span class="normal"><a href="#__codelineno-0-1767">1767</a></span>
<span class="normal"><a href="#__codelineno-0-1768">1768</a></span>
<span class="normal"><a href="#__codelineno-0-1769">1769</a></span>
<span class="normal"><a href="#__codelineno-0-1770">1770</a></span>
<span class="normal"><a href="#__codelineno-0-1771">1771</a></span>
<span class="normal"><a href="#__codelineno-0-1772">1772</a></span>
<span class="normal"><a href="#__codelineno-0-1773">1773</a></span>
<span class="normal"><a href="#__codelineno-0-1774">1774</a></span>
<span class="normal"><a href="#__codelineno-0-1775">1775</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1640" name="__codelineno-0-1640"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_ngtdm_features</span><span class="p">(</span>
<a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>    <span class="n">data</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>    <span class="n">mask</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>    <span class="n">n_bins</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-1644" name="__codelineno-0-1644"></a>    <span class="n">ngtdm_matrices</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645"></a>        <span class="nb">tuple</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1647" name="__codelineno-0-1647"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-1648" name="__codelineno-0-1648"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649"></a><span class="sd">    Calculate Neighbourhood Grey Tone Difference Matrix (NGTDM) features.</span>
<a id="__codelineno-0-1650" name="__codelineno-0-1650"></a>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a><span class="sd">    The NGTDM quantifies the difference between a grey value and the average grey value</span>
<a id="__codelineno-0-1652" name="__codelineno-0-1652"></a><span class="sd">    of its neighbours. It captures the coarseness and contrast of the texture.</span>
<a id="__codelineno-0-1653" name="__codelineno-0-1653"></a>
<a id="__codelineno-0-1654" name="__codelineno-0-1654"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1655" name="__codelineno-0-1655"></a><span class="sd">        data (npt.NDArray[np.floating[Any]]): The 3D image array containing discretised grey levels.</span>
<a id="__codelineno-0-1656" name="__codelineno-0-1656"></a><span class="sd">        mask (npt.NDArray[np.floating[Any]]): The 3D binary mask array defining the ROI.</span>
<a id="__codelineno-0-1657" name="__codelineno-0-1657"></a><span class="sd">        n_bins (int): The number of grey levels.</span>
<a id="__codelineno-0-1658" name="__codelineno-0-1658"></a><span class="sd">        ngtdm_matrices (Optional[tuple[npt.NDArray[np.floating[Any]], npt.NDArray[np.floating[Any]]]]): Pre-calculated NGTDM matrices</span>
<a id="__codelineno-0-1659" name="__codelineno-0-1659"></a><span class="sd">            (sum of absolute differences `s`, and count `n`).</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660"></a>
<a id="__codelineno-0-1661" name="__codelineno-0-1661"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1662" name="__codelineno-0-1662"></a><span class="sd">        dict[str, float]: A dictionary of calculated NGTDM features.</span>
<a id="__codelineno-0-1663" name="__codelineno-0-1663"></a><span class="sd">            Example keys: &#39;coarseness_QCDE&#39;, &#39;contrast_65HE&#39;, &#39;busyness_NQ30&#39;.</span>
<a id="__codelineno-0-1664" name="__codelineno-0-1664"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1665" name="__codelineno-0-1665"></a>    <span class="k">if</span> <span class="n">ngtdm_matrices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1666" name="__codelineno-0-1666"></a>        <span class="k">if</span> <span class="n">n_bins</span> <span class="o">&lt;=</span> <span class="mi">256</span><span class="p">:</span>
<a id="__codelineno-0-1667" name="__codelineno-0-1667"></a>            <span class="n">data_int</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1668" name="__codelineno-0-1668"></a>        <span class="k">elif</span> <span class="n">n_bins</span> <span class="o">&lt;=</span> <span class="mi">65536</span><span class="p">:</span>
<a id="__codelineno-0-1669" name="__codelineno-0-1669"></a>            <span class="n">data_int</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
<a id="__codelineno-0-1670" name="__codelineno-0-1670"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1671" name="__codelineno-0-1671"></a>            <span class="n">data_int</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>  <span class="c1"># pragma: no cover</span>
<a id="__codelineno-0-1672" name="__codelineno-0-1672"></a>
<a id="__codelineno-0-1673" name="__codelineno-0-1673"></a>        <span class="c1"># Determine n_threads for JIT call</span>
<a id="__codelineno-0-1674" name="__codelineno-0-1674"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1675" name="__codelineno-0-1675"></a>            <span class="n">n_threads</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">numba</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">NUMBA_NUM_THREADS</span><span class="p">)</span>
<a id="__codelineno-0-1676" name="__codelineno-0-1676"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
<a id="__codelineno-0-1677" name="__codelineno-0-1677"></a>            <span class="n">n_threads</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Fallback</span>
<a id="__codelineno-0-1678" name="__codelineno-0-1678"></a>
<a id="__codelineno-0-1679" name="__codelineno-0-1679"></a>        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_calculate_local_features_numba</span><span class="p">(</span>
<a id="__codelineno-0-1680" name="__codelineno-0-1680"></a>            <span class="n">data_int</span><span class="p">,</span>
<a id="__codelineno-0-1681" name="__codelineno-0-1681"></a>            <span class="n">mask</span><span class="p">,</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682"></a>            <span class="n">n_bins</span><span class="p">,</span>
<a id="__codelineno-0-1683" name="__codelineno-0-1683"></a>            <span class="n">calc_glcm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1684" name="__codelineno-0-1684"></a>            <span class="n">calc_glrlm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1685" name="__codelineno-0-1685"></a>            <span class="n">calc_ngtdm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1686" name="__codelineno-0-1686"></a>            <span class="n">calc_ngldm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1687" name="__codelineno-0-1687"></a>            <span class="n">offsets_26</span><span class="o">=</span><span class="n">OFFSETS_26</span><span class="p">,</span>
<a id="__codelineno-0-1688" name="__codelineno-0-1688"></a>            <span class="n">directions_13</span><span class="o">=</span><span class="n">DIRECTIONS_13</span><span class="p">,</span>
<a id="__codelineno-0-1689" name="__codelineno-0-1689"></a>            <span class="n">ngldm_alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-1690" name="__codelineno-0-1690"></a>            <span class="n">n_threads</span><span class="o">=</span><span class="n">n_threads</span><span class="p">,</span>
<a id="__codelineno-0-1691" name="__codelineno-0-1691"></a>        <span class="p">)</span>
<a id="__codelineno-0-1692" name="__codelineno-0-1692"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1693" name="__codelineno-0-1693"></a>        <span class="n">s</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">ngtdm_matrices</span>
<a id="__codelineno-0-1694" name="__codelineno-0-1694"></a>
<a id="__codelineno-0-1695" name="__codelineno-0-1695"></a>    <span class="c1"># s[i] is sum of absolute differences for grey level i+1</span>
<a id="__codelineno-0-1696" name="__codelineno-0-1696"></a>    <span class="c1"># n[i] is number of voxels of grey level i+1 with valid neighborhood</span>
<a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>
<a id="__codelineno-0-1698" name="__codelineno-0-1698"></a>    <span class="n">N_vp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-0-1699" name="__codelineno-0-1699"></a>    <span class="k">if</span> <span class="n">N_vp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1700" name="__codelineno-0-1700"></a>        <span class="k">return</span> <span class="p">{}</span>
<a id="__codelineno-0-1701" name="__codelineno-0-1701"></a>
<a id="__codelineno-0-1702" name="__codelineno-0-1702"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">n</span> <span class="o">/</span> <span class="n">N_vp</span>
<a id="__codelineno-0-1703" name="__codelineno-0-1703"></a>
<a id="__codelineno-0-1704" name="__codelineno-0-1704"></a>    <span class="c1"># Indices</span>
<a id="__codelineno-0-1705" name="__codelineno-0-1705"></a>    <span class="n">i_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_bins</span><span class="p">)</span>
<a id="__codelineno-0-1706" name="__codelineno-0-1706"></a>    <span class="n">I</span> <span class="o">=</span> <span class="n">i_idx</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># noqa: E741</span>
<a id="__codelineno-0-1707" name="__codelineno-0-1707"></a>
<a id="__codelineno-0-1708" name="__codelineno-0-1708"></a>    <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1709" name="__codelineno-0-1709"></a>
<a id="__codelineno-0-1710" name="__codelineno-0-1710"></a>    <span class="c1"># Filter for non-zero probabilities (required for Busyness, Complexity, Strength)</span>
<a id="__codelineno-0-1711" name="__codelineno-0-1711"></a>    <span class="n">mask_p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-1712" name="__codelineno-0-1712"></a>    <span class="n">p_nz</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">mask_p</span><span class="p">]</span>
<a id="__codelineno-0-1713" name="__codelineno-0-1713"></a>    <span class="n">s_nz</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">mask_p</span><span class="p">]</span>
<a id="__codelineno-0-1714" name="__codelineno-0-1714"></a>    <span class="n">I_nz</span> <span class="o">=</span> <span class="n">I</span><span class="p">[</span><span class="n">mask_p</span><span class="p">]</span>
<a id="__codelineno-0-1715" name="__codelineno-0-1715"></a>
<a id="__codelineno-0-1716" name="__codelineno-0-1716"></a>    <span class="c1"># Coarseness - QCDE</span>
<a id="__codelineno-0-1717" name="__codelineno-0-1717"></a>    <span class="n">sum_ps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p_nz</span> <span class="o">*</span> <span class="n">s_nz</span><span class="p">)</span>
<a id="__codelineno-0-1718" name="__codelineno-0-1718"></a>    <span class="k">if</span> <span class="n">sum_ps</span> <span class="o">&gt;</span> <span class="mf">1e-10</span><span class="p">:</span>
<a id="__codelineno-0-1719" name="__codelineno-0-1719"></a>        <span class="n">features</span><span class="p">[</span><span class="s2">&quot;coarseness_QCDE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">sum_ps</span>
<a id="__codelineno-0-1720" name="__codelineno-0-1720"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1721" name="__codelineno-0-1721"></a>        <span class="n">features</span><span class="p">[</span><span class="s2">&quot;coarseness_QCDE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e6</span>
<a id="__codelineno-0-1722" name="__codelineno-0-1722"></a>
<a id="__codelineno-0-1723" name="__codelineno-0-1723"></a>    <span class="c1"># Contrast - 65HE</span>
<a id="__codelineno-0-1724" name="__codelineno-0-1724"></a>    <span class="n">Ng_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_nz</span><span class="p">)</span>
<a id="__codelineno-0-1725" name="__codelineno-0-1725"></a>
<a id="__codelineno-0-1726" name="__codelineno-0-1726"></a>    <span class="k">if</span> <span class="n">Ng_p</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1727" name="__codelineno-0-1727"></a>        <span class="c1"># Term 1: Dynamic range variance</span>
<a id="__codelineno-0-1728" name="__codelineno-0-1728"></a>        <span class="n">Pi</span><span class="p">,</span> <span class="n">Pj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">p_nz</span><span class="p">,</span> <span class="n">p_nz</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1729" name="__codelineno-0-1729"></a>        <span class="n">Ii</span><span class="p">,</span> <span class="n">Ij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">I_nz</span><span class="p">,</span> <span class="n">I_nz</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1730" name="__codelineno-0-1730"></a>
<a id="__codelineno-0-1731" name="__codelineno-0-1731"></a>        <span class="n">term1_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Pi</span> <span class="o">*</span> <span class="n">Pj</span> <span class="o">*</span> <span class="p">((</span><span class="n">Ii</span> <span class="o">-</span> <span class="n">Ij</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1732" name="__codelineno-0-1732"></a>        <span class="n">term1</span> <span class="o">=</span> <span class="n">term1_sum</span> <span class="o">/</span> <span class="p">(</span><span class="n">Ng_p</span> <span class="o">*</span> <span class="p">(</span><span class="n">Ng_p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-1733" name="__codelineno-0-1733"></a>
<a id="__codelineno-0-1734" name="__codelineno-0-1734"></a>        <span class="c1"># Term 2: Intensity change</span>
<a id="__codelineno-0-1735" name="__codelineno-0-1735"></a>        <span class="n">sum_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a id="__codelineno-0-1736" name="__codelineno-0-1736"></a>        <span class="n">term2</span> <span class="o">=</span> <span class="n">sum_s</span> <span class="o">/</span> <span class="n">N_vp</span>
<a id="__codelineno-0-1737" name="__codelineno-0-1737"></a>
<a id="__codelineno-0-1738" name="__codelineno-0-1738"></a>        <span class="n">features</span><span class="p">[</span><span class="s2">&quot;contrast_65HE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">term1</span> <span class="o">*</span> <span class="n">term2</span>
<a id="__codelineno-0-1739" name="__codelineno-0-1739"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1740" name="__codelineno-0-1740"></a>        <span class="n">features</span><span class="p">[</span><span class="s2">&quot;contrast_65HE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-1741" name="__codelineno-0-1741"></a>
<a id="__codelineno-0-1742" name="__codelineno-0-1742"></a>    <span class="c1"># Busyness - NQ30</span>
<a id="__codelineno-0-1743" name="__codelineno-0-1743"></a>    <span class="n">IPi</span> <span class="o">=</span> <span class="n">I_nz</span> <span class="o">*</span> <span class="n">p_nz</span>
<a id="__codelineno-0-1744" name="__codelineno-0-1744"></a>
<a id="__codelineno-0-1745" name="__codelineno-0-1745"></a>    <span class="c1"># Grid</span>
<a id="__codelineno-0-1746" name="__codelineno-0-1746"></a>    <span class="n">IPi_grid</span><span class="p">,</span> <span class="n">IPj_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">IPi</span><span class="p">,</span> <span class="n">IPi</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1747" name="__codelineno-0-1747"></a>    <span class="n">denom_busyness</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">IPi_grid</span> <span class="o">-</span> <span class="n">IPj_grid</span><span class="p">))</span>
<a id="__codelineno-0-1748" name="__codelineno-0-1748"></a>
<a id="__codelineno-0-1749" name="__codelineno-0-1749"></a>    <span class="k">if</span> <span class="n">denom_busyness</span> <span class="o">&gt;</span> <span class="mf">1e-10</span><span class="p">:</span>
<a id="__codelineno-0-1750" name="__codelineno-0-1750"></a>        <span class="n">features</span><span class="p">[</span><span class="s2">&quot;busyness_NQ30&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_ps</span> <span class="o">/</span> <span class="n">denom_busyness</span>
<a id="__codelineno-0-1751" name="__codelineno-0-1751"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1752" name="__codelineno-0-1752"></a>        <span class="n">features</span><span class="p">[</span><span class="s2">&quot;busyness_NQ30&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-1753" name="__codelineno-0-1753"></a>
<a id="__codelineno-0-1754" name="__codelineno-0-1754"></a>    <span class="c1"># Complexity - HDEZ</span>
<a id="__codelineno-0-1755" name="__codelineno-0-1755"></a>    <span class="n">Pi</span><span class="p">,</span> <span class="n">Pj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">p_nz</span><span class="p">,</span> <span class="n">p_nz</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1756" name="__codelineno-0-1756"></a>    <span class="n">Si</span><span class="p">,</span> <span class="n">Sj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">s_nz</span><span class="p">,</span> <span class="n">s_nz</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1757" name="__codelineno-0-1757"></a>    <span class="n">Ii</span><span class="p">,</span> <span class="n">Ij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">I_nz</span><span class="p">,</span> <span class="n">I_nz</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1758" name="__codelineno-0-1758"></a>
<a id="__codelineno-0-1759" name="__codelineno-0-1759"></a>    <span class="n">denom_comp</span> <span class="o">=</span> <span class="n">Pi</span> <span class="o">+</span> <span class="n">Pj</span>
<a id="__codelineno-0-1760" name="__codelineno-0-1760"></a>    <span class="n">term_comp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Ii</span> <span class="o">-</span> <span class="n">Ij</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Pi</span> <span class="o">*</span> <span class="n">Si</span> <span class="o">+</span> <span class="n">Pj</span> <span class="o">*</span> <span class="n">Sj</span><span class="p">)</span> <span class="o">/</span> <span class="n">denom_comp</span>
<a id="__codelineno-0-1761" name="__codelineno-0-1761"></a>
<a id="__codelineno-0-1762" name="__codelineno-0-1762"></a>    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;complexity_HDEZ&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">N_vp</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">term_comp</span><span class="p">)</span>
<a id="__codelineno-0-1763" name="__codelineno-0-1763"></a>
<a id="__codelineno-0-1764" name="__codelineno-0-1764"></a>    <span class="c1"># Strength - 1X9X</span>
<a id="__codelineno-0-1765" name="__codelineno-0-1765"></a>    <span class="n">sum_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a id="__codelineno-0-1766" name="__codelineno-0-1766"></a>
<a id="__codelineno-0-1767" name="__codelineno-0-1767"></a>    <span class="n">term_str</span> <span class="o">=</span> <span class="p">(</span><span class="n">Pi</span> <span class="o">+</span> <span class="n">Pj</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">Ii</span> <span class="o">-</span> <span class="n">Ij</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1768" name="__codelineno-0-1768"></a>    <span class="n">sum_term_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">term_str</span><span class="p">)</span>
<a id="__codelineno-0-1769" name="__codelineno-0-1769"></a>
<a id="__codelineno-0-1770" name="__codelineno-0-1770"></a>    <span class="k">if</span> <span class="n">sum_s</span> <span class="o">&gt;</span> <span class="mf">1e-10</span><span class="p">:</span>
<a id="__codelineno-0-1771" name="__codelineno-0-1771"></a>        <span class="n">features</span><span class="p">[</span><span class="s2">&quot;strength_1X9X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_term_str</span> <span class="o">/</span> <span class="n">sum_s</span>
<a id="__codelineno-0-1772" name="__codelineno-0-1772"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1773" name="__codelineno-0-1773"></a>        <span class="n">features</span><span class="p">[</span><span class="s2">&quot;strength_1X9X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-1774" name="__codelineno-0-1774"></a>
<a id="__codelineno-0-1775" name="__codelineno-0-1775"></a>    <span class="k">return</span> <span class="n">features</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pictologics.features.texture.calculate_zone_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_zone_features</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">dist_map</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">,</span> <span class="n">calc_glszm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">calc_gldzm</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Wrapper for _calculate_zone_features_numba with buffer pooling.</p>
<p>This function manages pre-allocated buffers to reduce memory allocation
overhead for repeated calls (e.g., during batch processing).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>3D discretized image data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mask</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>3D mask array (not modified - copied internally by JIT function).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dist_map</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>3D distance map for GLDZM.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_bins</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of grey level bins.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>calc_glszm</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to calculate GLSZM.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>calc_gldzm</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to calculate GLDZM.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]], <span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.floating">floating</span>[<span title="typing.Any">Any</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (glszm, gldzm) matrices.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pictologics/features/texture.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1338" name="__codelineno-0-1338"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_zone_features</span><span class="p">(</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a>    <span class="n">data</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a>    <span class="n">mask</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a>    <span class="n">dist_map</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a>    <span class="n">n_bins</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a>    <span class="n">calc_glszm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>    <span class="n">calc_gldzm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]:</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a><span class="sd">    Wrapper for _calculate_zone_features_numba with buffer pooling.</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a><span class="sd">    This function manages pre-allocated buffers to reduce memory allocation</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a><span class="sd">    overhead for repeated calls (e.g., during batch processing).</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a><span class="sd">        data: 3D discretized image data.</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a><span class="sd">        mask: 3D mask array (not modified - copied internally by JIT function).</span>
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a><span class="sd">        dist_map: 3D distance map for GLDZM.</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a><span class="sd">        n_bins: Number of grey level bins.</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a><span class="sd">        calc_glszm: Whether to calculate GLSZM.</span>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a><span class="sd">        calc_gldzm: Whether to calculate GLDZM.</span>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a><span class="sd">        Tuple of (glszm, gldzm) matrices.</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>    <span class="c1"># For zone features, the worst-case number of zones is bounded by ROI voxel count.</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>    <span class="c1"># Sizing buffers to full image volume is extremely costly for sparse ROIs.</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>    <span class="n">max_zones</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>    <span class="k">if</span> <span class="n">max_zones</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>        <span class="n">max_zones</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>    <span class="c1"># Get pre-allocated buffers from pool</span>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a>    <span class="n">pool</span> <span class="o">=</span> <span class="n">_ZoneBufferPool</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>    <span class="n">res_gl</span><span class="p">,</span> <span class="n">res_size</span><span class="p">,</span> <span class="n">res_dist</span><span class="p">,</span> <span class="n">stack</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">get_buffers</span><span class="p">(</span><span class="n">max_zones</span><span class="p">)</span>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>    <span class="k">return</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a>        <span class="nb">tuple</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>        <span class="n">_calculate_zone_features_numba</span><span class="p">(</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a>            <span class="n">data</span><span class="p">,</span>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a>            <span class="n">mask</span><span class="p">,</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a>            <span class="n">dist_map</span><span class="p">,</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a>            <span class="n">n_bins</span><span class="p">,</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a>            <span class="n">res_gl</span><span class="p">,</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>            <span class="n">res_size</span><span class="p">,</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a>            <span class="n">res_dist</span><span class="p">,</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a>            <span class="n">stack</span><span class="p">,</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a>            <span class="n">calc_glszm</span><span class="p">,</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>            <span class="n">calc_gldzm</span><span class="p">,</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>        <span class="p">),</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2026 Márton Kolossváry. Licensed under Apache 2.0.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "search.suggest", "search.highlight", "content.code.copy", "content.tabs.link"], "search": "../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>